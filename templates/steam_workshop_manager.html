<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="steam.workshopManager">Steam åˆ›æ„å·¥åŠç®¡ç† - Project N.E.K.O.</title>
    <!-- i18next åŠ è½½å™¨ï¼ˆç»Ÿä¸€å¤„ç† CDN åŠ è½½å’Œåˆå§‹åŒ–ï¼‰ -->
    <script src="/static/i18n-i18next.js"></script>
    <script src="/static/common_dialogs.js"></script>
    <style>
        *:focus {
            outline: none !important;
            box-shadow: none !important;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
            background: #eee;
            color: #222;
            font-family: 'Segoe UI', Arial, sans-serif;
            overflow-x: hidden;
        }

        /* å¸ƒå±€å®¹å™¨ */
        .layout-container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
        }

        #sidebar {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 280px;
            width: 280px;
            padding: 15px;
            background: #fff;
            border-radius: 12px;
        }

        .main-content {
            flex: 1;
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            min-width: 0;
            /* é˜²æ­¢flexå­é¡¹æº¢å‡º */
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-label {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .control-select,
        .control-input {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 14px;
            cursor: pointer;
            background: #fff;
            color: #333;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23d5f1ff' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 35px;
        }

        .control-input {
            cursor: text;
            padding-right: 15px;
            background-image: none;
        }

        textarea.control-input {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .checkbox-label {
            cursor: pointer;
            font-size: 14px;
            user-select: none;
        }

        .btn {
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            cursor: pointer;
            color: white;
            transition: background 0.2s, transform 0.2s, box-shadow 0.2s;
            text-align: center;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .btn:disabled {
            background: #e0e0e0;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .btn-primary {
            background: #44b7fe;
        }

        .btn-primary:hover:not(:disabled) {
            background: #2662c8;
        }

        .btn-secondary {
            background: #d5f1ff;
            color: #333;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #b8e5ff;
            color: #333;
        }

        #sidebar .btn-secondary.active {
            background: #44b7fe;
            color: white;
        }

        .btn-success {
            background: #44b7fe;
        }

        .btn-success:hover:not(:disabled) {
            background: #2662c8;
        }

        .btn-danger {
            background: #ff6b6b;
        }

        .btn-danger:hover:not(:disabled) {
            background: #ff4757;
        }

        .btn-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-icon img {
            width: 16px;
            height: 16px;
            object-fit: contain;
        }

        .action-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .action-group .control-select,
        .action-group .control-input {
            flex-grow: 1;
        }

        h1 {
            color: #333;
            margin-bottom: 25px;
            font-weight: 600;
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        /* ä¸Šä¼ åŒºåŸŸæ ·å¼ - å»æ‰è¾¹æ¡†æ•ˆæœ */
        .upload-section {
            background: #fff;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .upload-section h2 {
            color: #333;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 20px;
        }

        /* æ ‡ç­¾å®¹å™¨æ ·å¼ */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .tag {
            background: #d5f1ff;
            color: #333;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background 0.2s;
        }

        .tag:hover {
            background: #b8e5ff;
        }

        .tag-remove {
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            line-height: 1;
        }

        /* ä¿¡æ¯æ¡†æ ·å¼ */
        .info-box {
            background: #e1f5fe;
            border-left: 4px solid #0288d1;
            padding: 16px 20px;
            margin: 16px 0;
            border-radius: 8px;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .info-box p {
            margin: 0;
            color: #01579b;
            font-weight: 500;
        }

        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        /* æ ‡ç­¾é¡µå¯¼èˆªæ ·å¼ */
        .navigation-tabs {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .tab-buttons {
            display: flex;
            padding: 5px;
            background: #f5f5f5;
        }

        .tab-button {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            color: #666;
            border-radius: 8px;
            transition: all 0.3s ease;
            margin: 0 2px;
        }

        .tab-button:hover {
            background: #e0e0e0;
            color: #333;
        }

        .tab-button.active {
            background: #44b7fe;
            color: white;
        }

        .tab-content {
            padding: 20px;
            background: #fff;
            border-radius: 0 0 12px 12px;
        }

        /* èœå•éƒ¨åˆ†æ ·å¼ */
        .menu-section h3,
        .config-section h4 {
            margin-top: 20px;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 8px;
        }

        .menu-section .button-group {
            margin-bottom: 5px;
        }

        #sidebar .btn-secondary {
            margin-bottom: 2px;
        }

        .menu-section {
            margin-bottom: 5px;
        }

        .info-text {
            font-size: 12px;
            color: #666;
            margin: 5px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .info-text p {
            margin: 0;
            line-height: 1.4;
        }

        /* é…ç½®åŒºåŸŸæ ·å¼ - å»æ‰è¾¹æ¡†æ•ˆæœ */
        .section-card {
            background: #fff;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }

        /* åŒºåŸŸæ ‡é¢˜æ ·å¼ */
        .section-header {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
        }

        .section-header h2 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .config-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .config-section h3 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .control-group {
            margin: 15px 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-label {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
            color: #333;
        }

        .control-input {
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            width: 100%;
            box-sizing: border-box;
        }

        .control-input:focus {
            outline: none;
            border-color: #44b7fe;
            box-shadow: 0 0 0 2px rgba(68, 183, 254, 0.2);
        }

        .control-group.checkbox {
            flex-direction: row;
            align-items: flex-start;
            gap: 10px;
        }

        .checkbox-label {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            flex: 1;
        }

        .help-text {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .help-text.success {
            color: #2e7d32;
        }

        .button-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 15px;
        }

        .action-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .action-group .control-input {
            flex: 1;
        }

        .action-group .btn {
            flex-shrink: 0;
            white-space: nowrap;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .button-group {
                flex-direction: column;
                align-items: stretch;
            }

            .control-group.checkbox {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        /* è®¾ç½®é¢æ¿ç›¸å…³æ ·å¼ */
        .settings-container {
            margin-top: 15px;
        }

        #settings-panel {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
            background-color: #fff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.4s ease;
            overflow: hidden;
        }

        #settings-panel h3 {
            margin-top: 0;
            color: #333;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .status-published {
            background-color: #2ecc71;
        }

        .status-pending {
            background-color: #f39c12;
        }

        .status-failed {
            background-color: #e74c3c;
        }

        /* è¿‡æ»¤å™¨æ§ä»¶ */
        .filter-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
            background: #fff;
            border-radius: 12px;
            padding: 15px 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-label {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            white-space: nowrap;
            text-align: right;
            padding-right: 5px;
            min-width: 40px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }

        /* å¡ç‰‡å®¹å™¨æ ·å¼ - tileè§†å›¾ */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 20px;
        }

        .workshop-card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
            border: 1px solid #e0e0e0;
            overflow: hidden;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            height: 380px;
        }

        .workshop-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
        }

        .card-image {
            width: 100%;
            height: 160px;
            object-fit: cover;
            display: block;
            background-color: #f5f5f5;
        }

        .card-content {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0 0 12px 0;
            color: #333;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* åˆ é™¤é‡å¤çš„status-badgeå®šä¹‰ï¼Œåªä¿ç•™ä¸‹æ–¹çš„ç»Ÿä¸€æ ·å¼ */

        .status-subscribed {
            background-color: #e6f3ff;
            color: #0066cc;
        }

        .status-downloading {
            background-color: #fff2cc;
            color: #cc7700;
        }

        .status-needs-update {
            background-color: #fff2cc;
            color: #cc7700;
        }

        .status-installed {
            background-color: #e6ffe6;
            color: #008000;
        }

        .author-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .author-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: #0078d4;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }

        .card-info {
            font-size: 13px;
            color: #888;
            margin-bottom: 8px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        /* ç»Ÿä¸€çš„çŠ¶æ€å¾½ç« æ ·å¼ */
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 0.85em;
            font-weight: 500;
            margin-right: 8px;
            margin-bottom: 8px;
            background: #f0f0f0;
            color: #666;
            text-align: center;
            box-sizing: border-box;
        }

        /* ä¸ºå¡ç‰‡å¤´éƒ¨çš„çŠ¶æ€å¾½ç« æ·»åŠ å®šä½æ ·å¼ */
        .card-header .status-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            margin: 0;
            z-index: 10;
            padding: 2px 8px;
            font-size: 11px;
            border-radius: 12px;
        }

        /* è°ƒæ•´å¡ç‰‡é«˜åº¦ä»¥é€‚åº”æ–°ç»“æ„ */
        .workshop-card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            height: auto;
            min-height: 380px;
        }

        /* å¡ç‰‡å¤´éƒ¨æ ·å¼ */
        .card-header {
            position: relative;
            overflow: hidden;
        }

        /* å¡ç‰‡ä¿¡æ¯ç½‘æ ¼å¸ƒå±€ */
        .card-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .card-info-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .info-label {
            font-size: 12px;
            color: #888;
            font-weight: 500;
        }

        .info-value {
            font-size: 14px;
            color: #333;
            font-weight: 400;
        }

        .status-subscribed {
            background: #e3f2fd;
            color: #1565c0;
        }

        .status-installed {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-downloading {
            background: #fff3e0;
            color: #ef6c00;
            animation: pulse 2s infinite;
        }

        .status-needs-update {
            background: #fff8e1;
            color: #ff8f00;
        }

        .status-error {
            background: #ffebee;
            color: #c62828;
        }

        @keyframes pulse {
            0% {
                opacity: 0.7;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.7;
            }
        }

        /* å®‰è£…è·¯å¾„æ ·å¼ */
        .card-path {
            background: #f5f7fa;
            padding: 10px 14px;
            border-radius: 10px;
            margin-bottom: 12px;
            overflow: hidden;
        }

        .path-text {
            font-size: 12px;
            color: #666;
            word-break: break-all;
            display: inline-block;
            max-width: 100%;
            line-height: 1.4;
        }

        /* å¡ç‰‡æ“ä½œæŒ‰é’® */
        .card-actions {
            margin-top: auto;
            padding-top: 12px;
            display: flex;
            gap: 8px;
        }

        .card-actions button,
        .card-actions .button {
            width: 100%;
            padding: 11px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
            text-align: center;
            display: inline-block;
        }

        .card-actions button:hover,
        .card-actions .button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12);
        }

        /* é»˜è®¤æŒ‰é’®æ ·å¼ */
        .card-actions button,
        .card-actions .button {
            background: #f1f5f9;
            color: #334155;
            border: 1px solid #e2e8f0;
        }

        .card-actions button:hover,
        .card-actions .button:hover {
            background: #e2e8f0;
            border-color: #cbd5e1;
        }

        /* ä¸»è¦æŒ‰é’®æ ·å¼ */
        .card-actions .button-primary {
            background: #44b7fe;
            color: white;
            border: 1px solid #44b7fe;
        }

        .card-actions .button-primary:hover {
            background: #2662c8;
            border-color: #2662c8;
        }

        /* ç¦ç”¨æŒ‰é’®æ ·å¼ */
        .card-actions .button-disabled {
            background: #f1f5f9;
            color: #94a3b8;
            border: 1px solid #e2e8f0;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .card-actions .button-disabled:hover {
            transform: none;
            box-shadow: none;
            background: #f1f5f9;
            border-color: #e2e8f0;
        }

        /* å±é™©æ“ä½œæŒ‰é’®æ ·å¼ */
        .card-actions .button-danger {
            background: #e11d48;
            color: white;
            border: 1px solid #e11d48;
        }

        .card-actions .button-danger:hover {
            background: #be123c;
            border-color: #be123c;
        }

        /* ä¸‹è½½è¿›åº¦æ¡æ ·å¼ */
        .download-progress {
            margin: 12px 0 8px 0;
            width: 100%;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0078d4, #44b7fe);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            color: #333;
            font-size: 0.75em;
            font-weight: bold;
            transition: width 0.3s ease;
            padding-right: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) inset;
        }

        /* ç©ºçŠ¶æ€æ ·å¼ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .empty-state p {
            font-size: 16px;
            margin-bottom: 20px;
        }

        /* åˆ†é¡µæ§ä»¶æ ·å¼ */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            gap: 12px;
        }

        .pagination .btn {
            min-width: 80px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 12px;
        }

        .pagination span {
            display: flex;
            align-items: center;
            height: 36px;
            min-width: 120px;
            text-align: center;
            padding: 0 8px;
        }

        /* æ¶ˆæ¯æç¤ºæ ·å¼ */
        .success-message,
        .error-message,
        .warning-message {
            padding: 12px 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .success-message {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .warning-message {
            background: #fff8e1;
            color: #ff8f00;
            border-left: 4px solid #ffb74d;
        }

        .message-close {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-weight: bold;
            font-size: 18px;
            color: inherit;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .message-close:hover {
            opacity: 1;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 650px;
            max-height: 85vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 1px solid #e0e0e0;
            background: #fafafa;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #888;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: background 0.2s, color 0.2s;
        }

        .modal-close:hover {
            background: #f0f0f0;
            color: #333;
        }

        .modal-body {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            padding: 20px 25px;
            border-top: 1px solid #e0e0e0;
            background: #fafafa;
            gap: 12px;
        }

        .item-detail-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 16px;
            padding: 20px;
            background: #fff;
        }

        .item-preview-large {
            width: 100%;
            max-height: 350px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .item-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .item-info-item {
            margin: 0;
        }

        .item-info-label {
            font-weight: 600;
            color: #334155;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 4px;
        }

        .item-description {
            margin-top: 20px;
            line-height: 1.7;
            color: #475569;
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #f1f5f9;
        }

        /* æµè§ˆå™¨é€šçŸ¥æ ·å¼ */
        .workshop-integration-info {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .workshop-integration-info h4 {
            color: #334155;
            margin: 0 0 12px 0;
            font-size: 16px;
            font-weight: 600;
        }

        .workshop-integration-info .info-text {
            font-size: 14px;
            color: #64748b;
        }

        .workshop-integration-info .info-text p {
            margin: 6px 0;
            line-height: 1.5;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 1024px) {
            .layout-container {
                flex-direction: column;
                margin: 10px;
                padding: 0;
            }

            #sidebar {
                width: auto;
                min-width: auto;
            }

            .cards-container {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .filter-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }

            .filter-group {
                flex-direction: column;
                align-items: stretch;
            }

            .item-info-grid {
                grid-template-columns: 1fr;
            }

            .modal-footer {
                flex-direction: column-reverse;
            }

            .modal-footer .btn {
                width: 100%;
            }
        }

        /* æ°´å¹³æ ‡ç­¾é¡µæ ·å¼ */
        .tabs {
            display: flex;
            flex-wrap: nowrap;
            border-radius: 8px;
            background: #f0f4f8;
            padding: 2px;
            margin-bottom: 15px;
            justify-content: space-between;
        }

        .tab {
            padding: 10px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            border-radius: 6px;
            transition: all 0.3s ease;
            text-align: center;
            white-space: nowrap;
            /* å“åº”å¼å®½åº¦è®¾ç½® */
            flex: 1;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* åª’ä½“æŸ¥è¯¢ - å½“çª—å£å®½åº¦å°äºç‰¹å®šå°ºå¯¸æ—¶è°ƒæ•´æ ‡ç­¾æ ·å¼ */
        @media (max-width: 600px) {
            .tab {
                flex: none;
                width: auto;
                min-width: 90px;
                padding: 10px 15px;
                font-size: 13px;
            }

            .tabs {
                justify-content: flex-start;
            }
        }

        /* å°çª—å£ç‰¹å®šæ ·å¼ç±» */
        .tabs.compact .tab {
            flex: 1;
            width: auto;
            padding: 10px 15px;
            text-align: center;
        }

        .tabs.compact {
            justify-content: flex-start;
            gap: 4px;
            /* è‡ªé€‚åº”å·¦ä¾§èœå•å®½åº¦ */
            width: 100%;
        }

        /* æ¢å¤å¤§çª—å£æ ·å¼çš„ç±» */
        .tabs.normal .tab {
            flex: 1;
            min-width: 0;
            padding: 10px 20px;
        }

        .tabs.normal {
            justify-content: space-between;
        }

        .tab:hover {
            background: #e1e8ed;
            color: #333;
        }

        .tab.active {
            background: #44b7fe;
            color: white;
            box-shadow: 0 2px 4px rgba(68, 183, 254, 0.3);
        }

        /* é¡µé¢æ§åˆ¶æŒ‰é’® */
        .page-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        /* çŠ¶æ€æ–‡æœ¬æ ·å¼ */
        #status {
            color: #4f8cff;
            font-size: 14px;
            font-weight: 500;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <!-- ä¾§è¾¹æ  -->
    <!-- å¸ƒå±€å®¹å™¨ -->
    <div class="layout-container">
        <!-- ä¾§è¾¹æ  -->
        <div id="sidebar">
            <!-- ä¸»è¦æ“ä½œç»„ -->
            <div class="menu-section">
                <!-- æ ‡ç­¾åˆ‡æ¢æŒ‰é’®ç»„ -->
                <div class="tabs compact" id="workshop-tabs">
                    <button class="tab active" onclick="switchTab('subscriptions-content')"
                        data-i18n="steam.subscriptions">è®¢é˜…å†…å®¹</button>
                    <button class="tab" onclick="switchTab('local-items-content')"
                        data-i18n="steam.localItems">æœ¬åœ°å†…å®¹</button>
                </div>

                <!-- ä¿®å¤çš„è‡ªå®šä¹‰tooltipå®ç° -->
                <style>
                    /* ç¡®ä¿ä¾§è¾¹æ ä½œä¸ºå®šä½å®¹å™¨ */
                    #sidebar {
                        position: relative;
                        overflow: visible;
                    }

                    /* æ ‡ç­¾æŒ‰é’®åŸºç¡€æ ·å¼ */
                    .tabs button {
                        position: relative;
                        cursor: pointer;
                        /* ç¦ç”¨æµè§ˆå™¨é»˜è®¤tooltip */
                        overflow: hidden;
                        text-overflow: ellipsis;
                    }

                    /* ç§»é™¤å¯èƒ½å­˜åœ¨çš„titleå±æ€§ */
                    .tabs button {
                        title: "";
                    }

                    /* å®Œå…¨é‡å†™çš„tooltipå®ç° */
                    .tabs button:hover {
                        /* ç§»é™¤é»˜è®¤çš„titleæç¤ºè¡Œä¸º */
                        pointer-events: auto;
                    }

                    /* æ·»åŠ å®‰å…¨çš„å·¥å…·æç¤ºå®ç° */
                    .tabs {
                        position: relative;
                        /* ç¡®ä¿tooltipåœ¨å®¹å™¨å†… */
                        contain: layout;
                    }

                    /* æ›¿ä»£æ–¹æ¡ˆï¼šé€šè¿‡JavaScriptæ§åˆ¶tooltipï¼Œå®Œå…¨é¿å…CSSå®šä½é—®é¢˜ */
                </style>

                <script>
                    // JavaScriptæ§åˆ¶çš„tooltipå®ç°
                    document.addEventListener('DOMContentLoaded', function () {
                        const tabButtons = document.querySelectorAll('.tabs button');

                        // åˆ›å»ºtooltipå…ƒç´ 
                        let tooltip = document.createElement('div');
                        tooltip.id = 'custom-tooltip';
                        tooltip.style.cssText = `
                        position: absolute;
                        background: rgba(0, 0, 0, 0.8);
                        color: white;
                        padding: 5px 10px;
                        border-radius: 4px;
                        font-size: 12px;
                        white-space: nowrap;
                        pointer-events: none;
                        z-index: 1000;
                        display: none;
                    `;
                        document.body.appendChild(tooltip);

                        // ä¸ºæ¯ä¸ªæ ‡ç­¾æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬
                        tabButtons.forEach(button => {
                            // è·å–æŒ‰é’®æ–‡æœ¬ä½œä¸ºtooltipå†…å®¹
                            const tooltipText = button.textContent.trim();

                            button.addEventListener('mouseenter', function (e) {
                                // è®¡ç®—tooltipä½ç½®
                                const buttonRect = button.getBoundingClientRect();
                                const sidebarRect = document.getElementById('sidebar').getBoundingClientRect();

                                // è®¡ç®—tooltipå°ºå¯¸
                                tooltip.textContent = tooltipText;
                                tooltip.style.display = 'block';
                                const tooltipRect = tooltip.getBoundingClientRect();

                                // ç¡®ä¿tooltipåœ¨ä¾§è¾¹æ å†…æ˜¾ç¤º
                                let left = buttonRect.left + buttonRect.width / 2 - tooltipRect.width / 2;

                                // æ£€æŸ¥å¹¶ä¿®æ­£å·¦ä¾§ä½ç½®
                                if (left < sidebarRect.left + 10) {
                                    left = sidebarRect.left + 10;
                                }
                                // æ£€æŸ¥å¹¶ä¿®æ­£å³ä¾§ä½ç½®
                                if (left + tooltipRect.width > sidebarRect.right - 10) {
                                    left = sidebarRect.right - tooltipRect.width - 10;
                                }

                                // è®¾ç½®tooltipä½ç½®
                                tooltip.style.left = left + 'px';
                                tooltip.style.top = (buttonRect.top - tooltipRect.height - 5) + 'px';
                            });

                            button.addEventListener('mouseleave', function () {
                                tooltip.style.display = 'none';
                            });

                            // é˜»æ­¢é»˜è®¤çš„titleæç¤º
                            button.addEventListener('mouseover', function (e) {
                                e.preventDefault();
                            });
                        });
                    });
                </script>
                <script>
                    // å“åº”å¼æ ‡ç­¾é¡µå¤„ç†
                    function updateTabsLayout() {
                        const tabs = document.getElementById('workshop-tabs');
                        const containerWidth = tabs.parentElement.clientWidth;

                        // å®šä¹‰åˆ‡æ¢é˜ˆå€¼
                        const thresholdWidth = 400;

                        if (containerWidth < thresholdWidth) {
                            tabs.classList.remove('normal');
                            tabs.classList.add('compact');
                        } else {
                            tabs.classList.remove('compact');
                            tabs.classList.add('normal');
                        }
                    }

                    // åˆå§‹åŒ–æ—¶è°ƒç”¨ä¸€æ¬¡
                    window.addEventListener('DOMContentLoaded', updateTabsLayout);
                    // ç›‘å¬çª—å£å¤§å°å˜åŒ–
                    window.addEventListener('resize', updateTabsLayout);
                </script>
            </div>



            <!-- å…³äºåˆ›æ„å·¥åŠé›†æˆè¯´æ˜ -->
            <div class="menu-section workshop-integration-info">
                <div class="info-text">
                    <p data-i18n="steam.pageDescription">é€šè¿‡æ­¤é¡µé¢ï¼Œæ‚¨å¯ä»¥æµè§ˆã€è®¢é˜…ã€ä¸‹è½½å’Œç®¡ç†Steamåˆ›æ„å·¥åŠä¸­çš„Live2Dæ¨¡å‹å’Œå£°éŸ³ã€‚</p>
                    <p data-i18n="steam.voiceNote">å¦‚æœ‰è¯­éŸ³éŸ³è‰²è¯·å‰å¾€live2dè®¾ç½®é¡µé¢æ‰‹åŠ¨æ³¨å†Œ</p>
                </div>
            </div>


        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- æ ‡é¢˜å·²ç§»é™¤ -->

            <!-- æ ‡ç­¾å†…å®¹å®¹å™¨ -->
            <div class="tab-contents">
                <!-- è®¢é˜…å†…å®¹æ ‡ç­¾é¡µ -->
                <div id="subscriptions-content" class="tab-content active">
                    <div class="section-card">
                        <div class="section-header">
                            <h2 data-i18n="steam.mySubscriptions">æˆ‘çš„è®¢é˜…ç‰©å“</h2>
                        </div>

                        <div class="filter-controls">
                            <div class="filter-group">
                                <div class="filter-label" data-i18n="steam.search">æœç´¢ï¼š</div>
                                <input type="text" id="search-subscription" class="control-input" placeholder=""
                                    onkeyup="filterSubscriptions(this.value)"
                                    data-i18n-placeholder="steam.searchPlaceholder">
                            </div>
                            <div class="filter-group">
                                <div class="filter-label" data-i18n="steam.sort.title">æ’åºï¼š</div>
                                <select id="sort-subscription" class="control-select" onchange="applySort(this.value)">
                                    <option value="name_asc" data-i18n="steam.sort.nameAsc">åç§°ï¼ˆå‡åºï¼‰</option>
                                    <option value="name_desc" data-i18n="steam.sort.nameDesc">åç§°ï¼ˆé™åºï¼‰</option>
                                    <option value="date_asc" data-i18n="steam.sort.dateAsc">è®¢é˜…æ—¥æœŸï¼ˆå‡åºï¼‰</option>
                                    <option value="date_desc" data-i18n="steam.sort.dateDesc">è®¢é˜…æ—¥æœŸï¼ˆé™åºï¼‰</option>
                                    <option value="size_asc" data-i18n="steam.sort.sizeAsc">æ–‡ä»¶å¤§å°ï¼ˆå‡åºï¼‰</option>
                                    <option value="size_desc" data-i18n="steam.sort.sizeDesc">æ–‡ä»¶å¤§å°ï¼ˆé™åºï¼‰</option>
                                    <option value="update_asc" data-i18n="steam.sort.updateAsc">æ›´æ–°æ—¶é—´ï¼ˆå‡åºï¼‰</option>
                                    <option value="update_desc" data-i18n="steam.sort.updateDesc">æ›´æ–°æ—¶é—´ï¼ˆé™åºï¼‰</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <button class="btn btn-primary" onclick="loadSubscriptions()"
                                    data-i18n="steam.refresh">åˆ·æ–°è®¢é˜…å†…å®¹</button>
                            </div>
                        </div>

                        <div id="subscriptions-result">
                            <!-- å¡ç‰‡å®¹å™¨ -->
                            <div id="subscriptions-list" class="cards-container">
                                <!-- ç©ºçŠ¶æ€ -->
                                <div class="empty-state">
                                    <p id="loading-text"></p>
                                    <button class="btn btn-secondary" onclick="loadSubscriptions()"
                                        id="reload-button"></button>
                                </div>
                            </div>

                            <div class="pagination">
                                <button class="btn btn-secondary" onclick="goToPrevPage()" disabled
                                    data-i18n="common.prevPage">ä¸Šä¸€é¡µ</button>
                                <span>ç¬¬ 1 é¡µï¼Œå…± 1 é¡µ</span>
                                <button class="btn btn-secondary" onclick="goToNextPage()" disabled
                                    data-i18n="common.nextPage">ä¸‹ä¸€é¡µ</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- æœ¬åœ°å†…å®¹æ ‡ç­¾é¡µ -->
                <div id="local-items-content" class="tab-content" style="display: none;">
                    <!-- ä¸Šä¼ è¡¨å•åŒºåŸŸ - é»˜è®¤éšè— -->
                    <div class="section-card upload-section" style="display: none;">
                        <div class="section-header">
                            <h2 data-i18n="steam.uploadToWorkshop">ä¸Šä¼ åˆ°åˆ›æ„å·¥åŠ</h2>
                        </div>
                        <div class="info-box">
                            <p data-i18n="steam.uploadInstructions">
                                è¯·å…ˆåœ¨"ç®¡ç†æœ¬åœ°ç‰©å“"åŒºåŸŸé€‰æ‹©ä¸€ä¸ªæœªå‘å¸ƒçš„ç‰©å“ï¼Œç„¶åç‚¹å‡»"å‡†å¤‡ä¸Šä¼ "æŒ‰é’®ã€‚å†…å®¹æ–‡ä»¶å¤¹è·¯å¾„å’Œé¢„è§ˆå›¾ç‰‡è·¯å¾„å°†è‡ªåŠ¨å¡«å……ã€‚</p>
                        </div>

                        <div id="message-area"></div>

                        <div class="control-group">
                            <div class="control-label" data-i18n="steam.title">æ ‡é¢˜ *</div>
                            <input type="text" id="item-title" class="control-input" placeholder="è¾“å…¥æ‚¨çš„åˆ›ä½œæ ‡é¢˜">
                        </div>

                        <div class="control-group">
                            <div class="control-label" data-i18n="steam.description">æè¿°</div>
                            <textarea id="item-description" class="control-input" placeholder="è¯¦ç»†æè¿°æ‚¨çš„åˆ›ä½œå†…å®¹..."
                                data-i18n-placeholder="steam.descriptionPlaceholder"></textarea>
                        </div>

                        <div class="control-group">
                            <div class="control-label" data-i18n="steam.contentFolderPath">å†…å®¹æ–‡ä»¶å¤¹è·¯å¾„ *</div>
                            <input type="text" id="content-folder" class="control-input" placeholder="ä»æœ¬åœ°ç‰©å“ä¸­è·å–çš„å†…å®¹æ–‡ä»¶å¤¹è·¯å¾„"
                                readonly>
                        </div>

                        <div class="control-group">
                            <div class="control-label" data-i18n="steam.previewImagePath">é¢„è§ˆå›¾ç‰‡è·¯å¾„ *</div>
                            <input type="text" id="preview-image" class="control-input" placeholder="ä»æœ¬åœ°ç‰©å“ä¸­è·å–çš„é¢„è§ˆå›¾ç‰‡è·¯å¾„"
                                readonly>
                            <div class="control-hint" style="color: red; font-size: 14px;"
                                data-i18n="steam.previewImageSizeHint">æç¤ºï¼šé¢„è§ˆå›¾ç‰‡å¤§å°éœ€è¦å°äº1MB</div>
                        </div>

                        <div class="control-group">
                            <div class="control-label" data-i18n="steam.tags">æ ‡ç­¾</div>
                            <input type="text" id="item-tags" class="control-input" placeholder="è¾“å…¥æ ‡ç­¾ï¼ŒæŒ‰å›è½¦æ·»åŠ "
                                data-i18n-placeholder="steam.tagsPlaceholder">
                            <div id="tags-container" class="tags-container"></div>
                        </div>

                        <div class="control-group">
                            <div class="control-label" data-i18n="steam.visibility">å¯è§æ€§</div>
                            <select id="visibility" class="control-select">
                                <option value="public" data-i18n="steam.visibilityPublic">å…¬å¼€</option>
                                <option value="friends" data-i18n="steam.visibilityFriends">ä»…å¥½å‹å¯è§</option>
                                <option value="private" data-i18n="steam.visibilityPrivate">ç§æœ‰</option>
                            </select>
                        </div>

                        <div class="control-group">
                            <div class="checkbox-container">
                                <input type="checkbox" id="allow-comments" class="control-checkbox" checked>
                                <label for="allow-comments" class="checkbox-label"
                                    data-i18n="steam.allowComments">å…è®¸è¯„è®º</label>
                            </div>
                        </div>

                        <div class="control-group">
                            <button class="btn btn-primary" onclick="uploadItem()">
                                <span data-i18n="steam.uploadToWorkshop">ä¸Šä¼ åˆ°åˆ›æ„å·¥åŠ</span>
                            </button>
                            <button class="btn btn-secondary" onclick="toggleUploadSection()">
                                <span data-i18n="steam.hideUploadSection">éšè—ä¸Šä¼ åŒº</span>
                            </button>
                            <div class="help-text" style="margin-top: 10px; font-size: 12px; color: #666;">
                                ç‚¹å‡»"ä¸Šä¼ "å³è¡¨ç¤ºæ‚¨åŒæ„ Steam åˆ›æ„å·¥åŠæœåŠ¡æ¡æ¬¾ï¼ŒåŒ…æ‹¬åˆ›æ„å·¥åŠæ³•å¾‹åè®®ï¼š
                                <a href="https://steamcommunity.com/sharedfiles/workshoplegalagreement" target="_blank"
                                    style="color: #44b7fe;">https://steamcommunity.com/sharedfiles/workshoplegalagreement</a>
                            </div>
                        </div>
                    </div>

                    <div class="section-card">
                        <div class="section-header">
                            <h2 data-i18n="steam.localItems">ç®¡ç†æœ¬åœ°ç‰©å“</h2>
                        </div>

                        <!-- æœç´¢å’Œæ’åºåŠŸèƒ½åŒºåŸŸ -->
                        <div class="filter-controls">
                            <div class="filter-group">
                                <div class="filter-label" data-i18n="steam.search">æœç´¢ï¼š</div>
                                <input type="text" id="search-local-items" class="control-input" placeholder="æœç´¢æœ¬åœ°ç‰©å“..."
                                    data-i18n-placeholder="steam.searchLocalItems">
                            </div>
                            <div class="filter-group">
                                <div class="filter-label" data-i18n="steam.sort.title">æ’åºï¼š</div>
                                <select id="sort-local-items" class="control-select">
                                    <option value="name_asc" data-i18n="steam.sort.nameAsc">åç§°ï¼ˆå‡åºï¼‰</option>
                                    <option value="name_desc" data-i18n="steam.sort.nameDesc">åç§°ï¼ˆé™åºï¼‰</option>
                                    <option value="date_asc" data-i18n="steam.sort.createDateAsc">åˆ›å»ºæ—¥æœŸï¼ˆå‡åºï¼‰</option>
                                    <option value="date_desc" data-i18n="steam.sort.createDateDesc">åˆ›å»ºæ—¥æœŸï¼ˆé™åºï¼‰</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <button class="btn btn-primary" onclick="scanLocalItems()" style="min-width: 160px;">
                                    <span data-i18n="steam.scanLocalItems">æ‰«ææœ¬åœ°ç‰©å“</span>
                                </button>
                                <button class="btn btn-secondary" onclick="uploadModelToLive2d()"
                                    style="min-width: 180px;">
                                    <span>ğŸ“</span> <span data-i18n="steam.importModel">å¯¼å…¥æ¨¡å‹</span>
                                </button>
                                <!-- éšè—çš„æ–‡ä»¶å¤¹é€‰æ‹©è¾“å…¥ -->
                                <input type="file" id="model-folder-upload" webkitdirectory style="display:none">
                            </div>
                        </div>

                        <div id="local-items-list" class="cards-container">
                            <div class="empty-state">
                                <p data-i18n="steam.emptyStateHint">è¯·è¾“å…¥å¹¶æ‰«æä¸€ä¸ªåŒ…å«æœ¬åœ°æ–‡ä»¶çš„æ–‡ä»¶å¤¹</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸Šä¼ å†…å®¹æ ‡ç­¾é¡µ -->
            <div id="upload-content" class="tab-content" style="display: none;">
                <div class="section-card upload-section">
                    <div class="section-header">
                        <h2 data-i18n="steam.uploadToWorkshop">ä¸Šä¼ åˆ°åˆ›æ„å·¥åŠ</h2>
                    </div>
                    <div class="info-box">
                        <p data-i18n="steam.uploadTip">ğŸ’¡ æ‚¨å¯ä»¥åœ¨"ç®¡ç†æœ¬åœ°ç‰©å“"ä¸­é€‰æ‹©ç‰©å“è‡ªåŠ¨å¡«å……è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‰‹åŠ¨è¾“å…¥å†…å®¹æ–‡ä»¶å¤¹å’Œé¢„è§ˆå›¾ç‰‡çš„å®Œæ•´è·¯å¾„ã€‚</p>
                    </div>

                    <div id="message-area"></div>

                    <div class="control-group">
                        <div class="control-label" data-i18n="steam.title">æ ‡é¢˜ *</div>
                        <input type="text" id="item-title" class="control-input" placeholder="è¾“å…¥æ‚¨çš„åˆ›ä½œæ ‡é¢˜"
                            data-i18n-placeholder="steam.titlePlaceholder">
                    </div>

                    <div class="control-group">
                        <div class="control-label" data-i18n="steam.description">æè¿°</div>
                        <textarea id="item-description" class="control-input" placeholder="è¯¦ç»†æè¿°æ‚¨çš„åˆ›ä½œå†…å®¹..."
                            data-i18n-placeholder="steam.descriptionPlaceholder"></textarea>
                    </div>

                    <div class="control-group">
                        <div class="control-label" data-i18n="steam.contentFolderPath">å†…å®¹æ–‡ä»¶å¤¹è·¯å¾„ *</div>
                        <input type="text" id="content-folder" class="control-input" placeholder="ä»æœ¬åœ°ç‰©å“ä¸­è·å–çš„å†…å®¹æ–‡ä»¶å¤¹è·¯å¾„"
                            readonly data-i18n-placeholder="steam.contentFolderPlaceholder">
                    </div>

                    <div class="control-group">
                        <div class="control-label" data-i18n="steam.previewImagePath">é¢„è§ˆå›¾ç‰‡è·¯å¾„ *</div>
                        <div class="action-group">
                            <input type="text" id="preview-image" class="control-input" placeholder="ä»æœ¬åœ°ç‰©å“ä¸­è·å–çš„é¢„è§ˆå›¾ç‰‡è·¯å¾„"
                                readonly data-i18n-placeholder="steam.previewImagePlaceholder">
                            <button class="btn btn-secondary" onclick="selectPreviewImage()"
                                data-i18n="steam.selectImage">é€‰æ‹©å›¾ç‰‡</button>
                        </div>
                        <!-- éšè—çš„å›¾ç‰‡æ–‡ä»¶é€‰æ‹©è¾“å…¥ -->
                        <input type="file" id="preview-image-upload" accept=".jpg,.jpeg,.png" style="display:none">
                        <div class="control-hint" style="color: red; font-size: 14px;"
                            data-i18n="steam.previewImageSizeHint">æç¤ºï¼šé¢„è§ˆå›¾ç‰‡å¤§å°éœ€è¦å°äº1MB</div>
                    </div>

                    <div class="control-group">
                        <div class="control-label" data-i18n="steam.tags">æ ‡ç­¾</div>
                        <input type="text" id="item-tags" class="control-input" placeholder="è¾“å…¥æ ‡ç­¾ï¼ŒæŒ‰å›è½¦æ·»åŠ "
                            data-i18n-placeholder="steam.tagsPlaceholder">
                        <div id="tags-container" class="tags-container"></div>
                    </div>

                    <div class="control-group checkbox">
                        <div class="checkbox-label">å…è®¸è¯„è®º</div>
                        <input type="checkbox" id="allow-comments" checked>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-primary" onclick="uploadItem()">ä¸Šä¼ åˆ°åˆ›æ„å·¥åŠ</button>
                    </div>
                    <div class="help-text" style="margin-top: 10px; font-size: 12px; color: #666;">
                        ç‚¹å‡»"ä¸Šä¼ "å³è¡¨ç¤ºæ‚¨åŒæ„ Steam åˆ›æ„å·¥åŠæœåŠ¡æ¡æ¬¾ï¼ŒåŒ…æ‹¬åˆ›æ„å·¥åŠæ³•å¾‹åè®®ï¼š
                        <a href="https://steamcommunity.com/sharedfiles/workshoplegalagreement" target="_blank"
                            style="color: #44b7fe;">https://steamcommunity.com/sharedfiles/workshoplegalagreement</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- ç‰©å“è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="itemDetailsModal" class="modal" onclick="closeModalOnOutsideClick(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle" data-i18n="steam.itemDetails">ç‰©å“è¯¦æƒ…</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="itemDetailContent" class="item-detail-container">
                    <!-- ç‰©å“è¯¦æƒ…å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                    <div class="empty-state">
                        <p data-i18n="steam.loadingItemDetails">æ­£åœ¨åŠ è½½ç‰©å“è¯¦æƒ…...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()" data-i18n="steam.close">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        // ä¸Šä¼ åŒºåŸŸåˆ‡æ¢åŠŸèƒ½
        function toggleUploadSection() {
            // æŸ¥æ‰¾ä¸Šä¼ è¡¨å•åŒºåŸŸ
            const uploadFormSection = document.querySelector('.upload-section');
            if (uploadFormSection) {
                // åˆ‡æ¢ä¸Šä¼ è¡¨å•çš„æ˜¾ç¤º/éšè—
                if (uploadFormSection.style.display === 'none' || uploadFormSection.style.display === '') {
                    uploadFormSection.style.display = 'block';
                    // æ»šåŠ¨åˆ°ä¸Šä¼ è¡¨å•åŒºåŸŸ
                    uploadFormSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else {
                    uploadFormSection.style.display = 'none';
                }
            }
        }

        // å¯¼å…¥æ¨¡å‹åˆ° live2d æ–‡ä»¶å¤¹ï¼ˆä¸ Live2D Manager ç›¸åŒï¼‰
        function uploadModelToLive2d() {
            document.getElementById('model-folder-upload').click();
        }

        // æ¨¡å‹æ–‡ä»¶å¤¹é€‰æ‹©åçš„å¤„ç†
        document.getElementById('model-folder-upload')?.addEventListener('change', async (e) => {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            showMessage(window.t ? window.t('steam.modelImporting') : 'æ­£åœ¨å¯¼å…¥æ¨¡å‹...', 'info');

            try {
                const formData = new FormData();
                for (const file of files) {
                    formData.append('files', file, file.webkitRelativePath || file.name);
                }

                const response = await fetch('/api/live2d/upload_model', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    showMessage(window.t ? window.t('steam.modelImportSuccess') : `æ¨¡å‹å¯¼å…¥æˆåŠŸ: ${result.message}`, 'success');
                    // åˆ·æ–°æœ¬åœ°ç‰©å“åˆ—è¡¨
                    setTimeout(() => {
                        scanLocalItems();
                    }, 1000);
                } else {
                    showMessage(window.t ? window.t('steam.modelImportFailed', { error: result.error }) : `å¯¼å…¥å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('å¯¼å…¥æ¨¡å‹å¤±è´¥:', error);
                showMessage(window.t ? window.t('steam.modelImportError', { error: error.message }) : `å¯¼å…¥é”™è¯¯: ${error.message}`, 'error');
            } finally {
                // é‡ç½®file inputä»¥å…è®¸é‡æ–°é€‰æ‹©åŒä¸€ä¸ªæ–‡ä»¶å¤¹
                e.target.value = '';
            }
        });

        // é€‰æ‹©é¢„è§ˆå›¾ç‰‡
        function selectPreviewImage() {
            document.getElementById('preview-image-upload').click();
        }

        // é¢„è§ˆå›¾ç‰‡é€‰æ‹©åä¸Šä¼ åˆ°ä¸´æ—¶ä½ç½®
        document.getElementById('preview-image-upload')?.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆå°äº1MBï¼‰
            if (file.size > 1024 * 1024) {
                showMessage(window.t ? window.t('steam.previewImageTooLarge') : 'é¢„è§ˆå›¾ç‰‡å¤§å°å¿…é¡»å°äº1MB', 'error');
                return;
            }

            showMessage(window.t ? window.t('steam.uploadingPreviewImage') : 'æ­£åœ¨ä¸Šä¼ é¢„è§ˆå›¾ç‰‡...', 'info');

            try {
                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch('/api/steam/upload-preview-image', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    document.getElementById('preview-image').value = result.path;
                    showMessage(window.t ? window.t('steam.previewImageUploaded') : 'é¢„è§ˆå›¾ç‰‡å·²é€‰æ‹©', 'success');
                } else {
                    showMessage(window.t ? window.t('steam.previewImageUploadFailed', { error: result.error }) : `ä¸Šä¼ å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('ä¸Šä¼ é¢„è§ˆå›¾ç‰‡å¤±è´¥:', error);
                showMessage(window.t ? window.t('steam.previewImageUploadError', { error: error.message }) : `ä¸Šä¼ é”™è¯¯: ${error.message}`, 'error');
            } finally {
                // é‡ç½®file input
                e.target.value = '';
            }
        });

        // æœ¬åœ°ç‰©å“åŒºåŸŸåˆ‡æ¢åŠŸèƒ½
        function toggleLocalItemsSection() {
            const localItemsSection = document.getElementById('local-items');
            const toggleButton = document.getElementById('local-items-toggle-button');

            // ç¡®ä¿æœ¬åœ°ç‰©å“å†…å®¹æ ‡ç­¾é¡µå¯è§
            const localItemsContent = document.getElementById('local-items-content');
            if (localItemsContent && localItemsContent.style.display === 'none') {
                switchTab('local-items-content');
                return;
            }

            // åˆ‡æ¢æœ¬åœ°ç‰©å“åŒºåŸŸçš„æ˜¾ç¤º/éšè—
            if (localItemsSection && localItemsSection.style.display === 'none') {
                // å…ˆæ‰«ææœ¬åœ°ç‰©å“
                scanLocalItems();
                localItemsSection.style.display = 'block';
                if (toggleButton) {
                    toggleButton.textContent = window.t ? window.t('steam.localItemsHide') : 'éšè—æœ¬åœ°ç‰©å“';
                }
                // å¹³æ»‘æ»šåŠ¨åˆ°æœ¬åœ°ç‰©å“åŒºåŸŸ
                localItemsSection.scrollIntoView({ behavior: 'smooth' });
            } else if (localItemsSection) {
                localItemsSection.style.display = 'none';
                if (toggleButton) {
                    toggleButton.textContent = window.t ? window.t('steam.localItemsManage') : 'ç®¡ç†æœ¬åœ°ç‰©å“';
                }
            }
        }

        // æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½
        function switchTab(tabId) {

            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.style.display = 'none';
            });

            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾æŒ‰é’®çš„æ´»åŠ¨çŠ¶æ€
            const tabButtons = document.querySelectorAll('.tab');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });

            // ä¸ºå½“å‰ç‚¹å‡»çš„æ ‡ç­¾æŒ‰é’®æ·»åŠ æ´»åŠ¨çŠ¶æ€
            if (event && event.target) {
                const clickedButton = event.target;
                clickedButton.classList.add('active');
            } else {
                // éç‚¹å‡»äº‹ä»¶è°ƒç”¨æ—¶ï¼Œé€šè¿‡tabIdæ‰¾åˆ°å¯¹åº”çš„æ ‡ç­¾æŒ‰é’®
                const matchingTab = Array.from(tabButtons).find(btn =>
                    btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(tabId)
                );
                if (matchingTab) {
                    matchingTab.classList.add('active');
                }
            }

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            const selectedTab = document.getElementById(tabId);
            if (selectedTab) {
                selectedTab.style.display = 'block';
            }

            // è®¾ç½®é€‰ä¸­çš„æ ‡ç­¾æŒ‰é’®ä¸ºæ´»åŠ¨çŠ¶æ€ï¼ˆå…¼å®¹æ—§çš„æ ‡ç­¾æŒ‰é’®ï¼‰
            tabButtons.forEach(button => {
                if (button.getAttribute('onclick') && button.getAttribute('onclick').includes(tabId)) {
                    button.classList.add('active');
                }
            });

            // è®¾ç½®ä¾§è¾¹æ ä¸­å¯¹åº”çš„æŒ‰é’®ä¸ºæ´»åŠ¨çŠ¶æ€
            const sidebarButtons = document.querySelectorAll('.sidebar-tab-button');
            if (sidebarButtons.length > 0) {
                sidebarButtons.forEach(button => {
                    if (button.getAttribute('onclick') && button.getAttribute('onclick').includes(tabId)) {
                        button.classList.add('active');
                    }
                });
            }

            // å¦‚æœåˆ‡æ¢åˆ°æœ¬åœ°å†…å®¹ï¼Œç¡®ä¿æœ¬åœ°ç‰©å“åˆ—è¡¨å¯è§
            if (tabId === 'local-items-content') {
                const localItemsSection = document.getElementById('local-items');
                if (localItemsSection && localItemsSection.style.display === 'none') {
                    // å…ˆæ‰«ææœ¬åœ°ç‰©å“å†æ˜¾ç¤º
                    scanLocalItems();
                    localItemsSection.style.display = 'block';
                    const toggleButton = document.getElementById('local-items-toggle-button');
                    if (toggleButton) {
                        toggleButton.textContent = window.t ? window.t('steam.localItemsHide') : 'éšè—æœ¬åœ°ç‰©å“';
                    }
                }

                // ç¡®ä¿ä¸Šä¼ è¡¨å•åŒºåŸŸåˆå§‹éšè—
                const uploadFormSection = document.querySelector('.upload-section');
                if (uploadFormSection) {
                    uploadFormSection.style.display = 'none';
                }
            }
        }

        // æç¤ºï¼šç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œæµè§ˆæŒ‰é’®ä»…æä¾›è·¯å¾„è¾“å…¥æç¤º

        // é€‰æ‹©æ–‡ä»¶å¤¹å¹¶å¡«å……åˆ°æŒ‡å®šè¾“å…¥æ¡†
        async function selectFolderForInput(inputId) {
            try {
                // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ File System Access API
                if (!('showDirectoryPicker' in window)) {
                    showMessage(window.t ? window.t('steam.folderPickerNotSupported') : 'å½“å‰æµè§ˆå™¨ä¸æ”¯æŒç›®å½•é€‰æ‹©ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥è·¯å¾„', 'warning');
                    // ç§»é™¤ readonly å±æ€§è®©ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨è¾“å…¥
                    document.getElementById(inputId).removeAttribute('readonly');
                    return;
                }

                const dirHandle = await window.showDirectoryPicker({
                    mode: 'read'
                });

                // è·å–é€‰ä¸­ç›®å½•çš„è·¯å¾„ï¼ˆé€šè¿‡ç›®å½•åç§°ï¼‰
                // æ³¨æ„ï¼šFile System Access API ä¸ç›´æ¥æä¾›å®Œæ•´è·¯å¾„ï¼Œåªæä¾›ç›®å½•åç§°
                // æˆ‘ä»¬éœ€è¦é€šçŸ¥ç”¨æˆ·å·²é€‰æ‹©çš„ç›®å½•å
                const folderName = dirHandle.name;

                // ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œæ— æ³•è·å–å®Œæ•´è·¯å¾„
                // æç¤ºç”¨æˆ·è¾“å…¥å®Œæ•´è·¯å¾„
                showMessage(window.t ? window.t('steam.folderSelectedPartial', { name: folderName }) :
                    `å·²é€‰æ‹©ç›®å½•: "${folderName}"ã€‚ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥å®Œæ•´è·¯å¾„`, 'warning');

                // ç§»é™¤ readonly è®©ç”¨æˆ·å¯ä»¥è¾“å…¥å®Œæ•´è·¯å¾„
                document.getElementById(inputId).removeAttribute('readonly');
                document.getElementById(inputId).focus();

            } catch (error) {
                if (error.name === 'AbortError') {
                    // ç”¨æˆ·å–æ¶ˆäº†é€‰æ‹©
                    showMessage(window.t ? window.t('steam.folderSelectionCancelled') : 'å·²å–æ¶ˆç›®å½•é€‰æ‹©', 'info');
                } else {
                    console.error('é€‰æ‹©ç›®å½•å¤±è´¥:', error);
                    showMessage(window.t ? window.t('steam.folderSelectionError') : 'é€‰æ‹©ç›®å½•å¤±è´¥', 'error');
                }
            }
        }

        // åŠ è½½é»˜è®¤é…ç½® - ä¼˜å…ˆä½¿ç”¨ live2d_dir ä½œä¸ºé»˜è®¤å€¼
        function loadDefaultConfig() {
            showMessage(window.t ? window.t('steam.loadingConfig') : 'æ­£åœ¨åŠ è½½é…ç½®...', 'info');

            // å…ˆè·å–ç³»ç»Ÿ live2d_dir ä½œä¸ºé»˜è®¤å€¼
            Promise.all([
                fetch('/api/steam/workshop/config').then(r => r.json()),
                fetch('/api/config/info').then(r => r.json()).catch(() => ({ live2d_dir: '' }))
            ])
                .then(([workshopData, configInfo]) => {
                    if (workshopData.success) {
                        // ä¼˜å…ˆä½¿ç”¨ç”¨æˆ·é…ç½®çš„è·¯å¾„ï¼Œå¦åˆ™ä½¿ç”¨ live2d_dir
                        const live2dDir = configInfo.live2d_dir || '';
                        const defaultFolder = workshopData.config.user_mod_folder ||
                            workshopData.config.default_workshop_folder ||
                            live2dDir;

                        document.getElementById('default-workshop-folder').value = defaultFolder;

                        showMessage(window.t ? window.t('steam.configLoadSuccess') : 'é…ç½®åŠ è½½æˆåŠŸ', 'success');
                    } else {
                        showMessage(window.t ? window.t('steam.configLoadFailed', { error: workshopData.error || (window.t ? window.t('common.unknownError') : 'æœªçŸ¥é”™è¯¯') }) : `é…ç½®åŠ è½½å¤±è´¥: ${workshopData.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    }
                })
                .catch(error => {
                    console.error('åŠ è½½é…ç½®æ—¶å‡ºé”™:', error);
                    showMessage(window.t ? window.t('steam.configLoadError', { error: error.message }) : `é…ç½®åŠ è½½é”™è¯¯: ${error.message}`, 'error');
                });
        }

        // ä¿å­˜é»˜è®¤é…ç½®
        function saveDefaultConfig() {
            const defaultFolder = document.getElementById('default-workshop-folder').value.trim();

            // éªŒè¯é»˜è®¤æ–‡ä»¶å¤¹è·¯å¾„æ ¼å¼ï¼ˆå¦‚æœæä¾›äº†ï¼‰
            if (defaultFolder && defaultFolder.length < 3) {
                showMessage(window.t ? window.t('steam.invalidFolderPath') : 'æ— æ•ˆçš„æ–‡ä»¶å¤¹è·¯å¾„', 'error');
                return;
            }

            showMessage(window.t ? window.t('steam.savingConfig') : 'æ­£åœ¨ä¿å­˜é…ç½®...', 'info');

            fetch('/api/steam/workshop/config', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    user_mod_folder: defaultFolder
                })
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        showMessage(window.t ? window.t('steam.configSaveSuccess') : 'é…ç½®ä¿å­˜æˆåŠŸ', 'success');
                    } else {
                        showMessage(window.t ? window.t('steam.configSaveFailed', { error: data.error || (window.t ? window.t('common.unknownError') : 'æœªçŸ¥é”™è¯¯') }) : `é…ç½®ä¿å­˜å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    }
                })
                .catch(error => {
                    console.error('ä¿å­˜é…ç½®æ—¶å‡ºé”™:', error);
                    showMessage(window.t ? window.t('steam.configSaveError', { error: error.message }) : `é…ç½®ä¿å­˜é”™è¯¯: ${error.message}`, 'error');
                });
        }

        // åˆ‡æ¢è®¾ç½®é¢æ¿çš„æ˜¾ç¤º/éšè—
        function toggleSettingsPanel() {
            const panel = document.getElementById('settings-panel');
            const icon = document.getElementById('settings-toggle-icon');
            // ä½¿ç”¨iconçš„çˆ¶å…ƒç´ ä½œä¸ºtoggleButtonï¼Œå› ä¸ºæŒ‰é’®çš„ç±»å·²ç»æ›´æ”¹
            const toggleButton = icon.parentElement;

            if (panel.style.display === 'none') {
                // æ˜¾ç¤ºé¢æ¿ï¼Œæ·»åŠ ç®€å•åŠ¨ç”»æ•ˆæœ
                panel.style.display = 'block';
                panel.style.opacity = '0';
                panel.style.transition = 'opacity 0.3s ease-in-out';

                // å¼ºåˆ¶é‡ç»˜
                void panel.offsetWidth;

                // è®¾ç½®é€æ˜åº¦ä¸º1ï¼Œè§¦å‘è¿‡æ¸¡åŠ¨ç”»
                panel.style.opacity = '1';

                // æ›´æ–°æŒ‰é’®æ–‡å­—å’Œå›¾æ ‡
                icon.textContent = 'â–¼';
                toggleButton.classList.remove('btn-secondary');
                toggleButton.classList.add('btn-primary');
            } else {
                // éšè—é¢æ¿ï¼Œæ·»åŠ ç®€å•åŠ¨ç”»æ•ˆæœ
                panel.style.opacity = '0';
                panel.style.transition = 'opacity 0.3s ease-in-out';

                // åŠ¨ç”»ç»“æŸåéšè—
                setTimeout(() => {
                    panel.style.display = 'none';
                }, 300);

                // æ›´æ–°æŒ‰é’®æ–‡å­—å’Œå›¾æ ‡
                icon.textContent = 'âš™ï¸';
                toggleButton.classList.remove('btn-primary');
                toggleButton.classList.add('btn-secondary');
            }
        }



        // æ‰«ææœ¬åœ°ç‰©å“ - ç°åœ¨ä»…ä½¿ç”¨é»˜è®¤è·¯å¾„
        function scanLocalItems() {
            console.log('å¼€å§‹æ‰«ææœ¬åœ°ç‰©å“...');

            // æ˜¾ç¤ºæ‰«æå¼€å§‹æç¤º
            const startMessage = showMessage(window.t ? window.t('steam.scanningWorkshop') : 'æ­£åœ¨æ‰«æWorkshopç‰©å“...', 'info');
            console.log('å·²æ˜¾ç¤ºæ‰«æå¼€å§‹æç¤º');

            // è°ƒç”¨APIæ‰«ææœ¬åœ°æ–‡ä»¶å¤¹ä¸­çš„ç‰©å“
            fetch('/api/steam/workshop/local-items/scan', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({})
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTPé”™è¯¯ï¼ŒçŠ¶æ€ç : ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('æ‰«æå®Œæˆï¼Œæ•°æ®è¿”å›:', data);

                    if (data.success) {
                        // è·å–æœ¬åœ°ç‰©å“åˆ—è¡¨
                        const localItems = data.local_items || [];
                        const publishedItems = data.published_items || [];

                        // æ›´æ–°UIæ˜¾ç¤ºæœ¬åœ°ç‰©å“
                        displayLocalItems(localItems, publishedItems);

                        // ç›´æ¥æ˜¾ç¤ºæ‰«æå®Œæˆæç¤ºï¼Œä½¿ç”¨ç®€å•æ¸…æ™°çš„æ¶ˆæ¯
                        const successMessage = window.t ? window.t('steam.scanComplete', { count: localItems.length }) : `æ‰«æå®Œæˆï¼Œå…±æ‰¾åˆ° ${localItems.length} ä¸ªç‰©å“`;
                        console.log('å‡†å¤‡æ˜¾ç¤ºæˆåŠŸæç¤º:', successMessage);

                        // ä½¿ç”¨ç‹¬ç«‹çš„æç¤ºå…ƒç´ ï¼Œç¡®ä¿ä¸å¼€å§‹æç¤ºåˆ†å¼€
                        const messageElement = document.createElement('div');
                        messageElement.innerHTML = successMessage;
                        messageElement.style.cssText = `
                        position: fixed;
                        top: 60px;
                        right: 20px;
                        padding: 15px 20px;
                        background: #e8f5e9;
                        color: #2e7d32;
                        border-radius: 6px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                        z-index: 99999;
                        font-weight: bold;
                        opacity: 0;
                        transform: translateY(-10px);
                        transition: opacity 0.3s ease, transform 0.3s ease;
                    `;

                        document.body.appendChild(messageElement);

                        // è§¦å‘åŠ¨ç”»
                        setTimeout(() => {
                            messageElement.style.opacity = '1';
                            messageElement.style.transform = 'translateY(0)';
                        }, 10);

                        // 5ç§’åè‡ªåŠ¨æ¶ˆå¤±
                        setTimeout(() => {
                            messageElement.style.opacity = '0';
                            messageElement.style.transform = 'translateY(-10px)';
                            setTimeout(() => {
                                messageElement.remove();
                            }, 300);
                        }, 3000);

                        console.log('æˆåŠŸæç¤ºå·²æ˜¾ç¤º');
                    } else {
                        const errorMessage = window.t ? window.t('steam.scanFailed', { error: data.error || (window.t ? window.t('common.unknownError') : 'æœªçŸ¥é”™è¯¯') }) : `æ‰«æå¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}`;
                        showMessage(errorMessage, 'error', 3000);
                    }
                })
                .catch(error => {
                    console.error('æ‰«ææœ¬åœ°ç‰©å“å¤±è´¥:', error);
                    showMessage(window.t ? window.t('steam.scanError', { error: error.message }) : `æ‰«ææ—¶å‡ºé”™: ${error.message}`, 'error', 3000);
                });
        }

        // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        async function doesFileExist(filePath) {
            try {
                const response = await fetch(`/api/file-exists?path=${encodeURIComponent(filePath)}`);
                const result = await response.json();
                return result.exists;
            } catch (error) {
                // å¦‚æœAPIä¸å¯ç”¨ï¼Œè¿”å›false
                return false;
            }
        }

        // æŸ¥æ‰¾é¢„è§ˆå›¾ç‰‡
        async function findPreviewImage(folderPath) {
            try {
                // å°è¯•æŸ¥æ‰¾å¸¸è§çš„é¢„è§ˆå›¾ç‰‡æ–‡ä»¶
                const commonImageNames = ['preview.jpg', 'preview.png', 'thumbnail.jpg', 'thumbnail.png', 'icon.jpg', 'icon.png', 'header.jpg', 'header.png'];

                for (const imageName of commonImageNames) {
                    const imagePath = `${folderPath}/${imageName}`;
                    if (await doesFileExist(imagePath)) {
                        return imagePath;
                    }
                }

                // å¦‚æœæ‰¾ä¸åˆ°å¸¸è§é¢„è§ˆå›¾ï¼Œå°è¯•ä½¿ç”¨APIè·å–æ–‡ä»¶å¤¹ä¸­çš„ç¬¬ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶
                const response = await fetch(`/api/find-first-image?folder=${encodeURIComponent(folderPath)}`);
                const result = await response.json();

                if (result.success && result.imagePath) {
                    return result.imagePath;
                }
            } catch (error) {
                console.error('æŸ¥æ‰¾é¢„è§ˆå›¾ç‰‡å¤±è´¥:', error);
            }

            return null;
        }

        // åˆ›æ„å·¥åŠç‰©å“å¯¹æ¯”
        async function compareLocalWithWorkshop(localItem) {
            try {
                // è·å–å·²å‘å¸ƒçš„åˆ›æ„å·¥åŠç‰©å“
                const workshopItems = await getWorkshopItems();

                // æ¯”è¾ƒåç§°
                for (const workshopItem of workshopItems) {
                    if (areNamesSimilar(localItem.name, workshopItem.title)) {
                        return {
                            exists: true,
                            item: workshopItem,
                            reason: 'åç§°ç›¸ä¼¼'
                        };
                    }
                }
            } catch (error) {
                console.error('åˆ›æ„å·¥åŠå¯¹æ¯”å¤±è´¥:', error);
            }

            return { exists: false };
        }

        // æ£€æŸ¥åç§°æ˜¯å¦ç›¸ä¼¼
        function areNamesSimilar(name1, name2) {
            // ç®€å•çš„ç›¸ä¼¼åº¦æ£€æŸ¥ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æ”¹è¿›
            name1 = name1.toLowerCase().trim();
            name2 = name2.toLowerCase().trim();

            // å¦‚æœå®Œå…¨ç›¸åŒï¼Œç›´æ¥è¿”å›true
            if (name1 === name2) return true;

            // å¦‚æœä¸€ä¸ªåç§°åŒ…å«å¦ä¸€ä¸ªåç§°
            if (name1.includes(name2) || name2.includes(name1)) return true;

            // è®¡ç®—ç¼–è¾‘è·ç¦»ï¼ˆç®€å•ç‰ˆæœ¬ï¼‰
            if (Math.abs(name1.length - name2.length) > 3) return false;

            return false;
        }

        // è·å–åˆ›æ„å·¥åŠç‰©å“åˆ—è¡¨
        async function getWorkshopItems() {
            try {
                const response = await fetch('/api/steam/workshop/subscribed-items');
                const data = await response.json();
                if (data.success) {
                    return data.items;
                }
            } catch (error) {
                console.error('è·å–åˆ›æ„å·¥åŠç‰©å“å¤±è´¥:', error);
            }
            return [];
        }

        // æ˜¾ç¤ºæœ¬åœ°ç‰©å“å¡ç‰‡
        function displayLocalItems(localItems, publishedItems) {
            const itemsList = document.getElementById('local-items-list');

            if (localItems.length === 0) {
                const emptyMessage = window.t ? window.t('steam.no_local_items') : 'åœ¨æŒ‡å®šæ–‡ä»¶å¤¹ä¸­æœªæ‰¾åˆ°ä»»ä½•åˆ›æ„å·¥åŠç‰©å“';
                itemsList.innerHTML = `
                    <div class="empty-state">
                        <p>${emptyMessage}</p>
                    </div>
                `;
                return;
            }

            // åˆ›å»ºç‰©å“å¡ç‰‡HTML
            itemsList.innerHTML = localItems.map(item => {
                // æ£€æŸ¥è¯¥ç‰©å“æ˜¯å¦å·²å‘å¸ƒåˆ°åˆ›æ„å·¥åŠ
                const isPublished = publishedItems.some(published =>
                    published.localId === item.id ||
                    (published.title && item.name &&
                        published.title.toLowerCase() === item.name.toLowerCase())
                );

                // ç¡®å®šçŠ¶æ€ç±»å’Œæ–‡æœ¬
                let statusClass = 'status-error';
                let statusText = window.t ? window.t('steam.status.unpublished') : 'æœªå‘å¸ƒ';

                if (isPublished) {
                    statusClass = 'status-published';
                    statusText = window.t ? window.t('steam.status.published') : 'å·²å‘å¸ƒ';
                }

                // ç”Ÿæˆé¢„è§ˆå›¾ç‰‡URLæˆ–ä½¿ç”¨é»˜è®¤å›¾ç‰‡
                // ä½¿ç”¨å›¾ç‰‡ä»£ç†APIè®¿é—®æœ¬åœ°å›¾ç‰‡ï¼Œé¿å…æµè§ˆå™¨å®‰å…¨é™åˆ¶
                // ç¡®ä¿Windowsè·¯å¾„ä¸­çš„åæ–œæ æ­£ç¡®ç¼–ç 
                const previewUrl = item.previewImage ? `/api/proxy-image?image_path=${encodeURIComponent(item.previewImage.replace(/\\/g, '/'))}` : '../static/icons/Steam_icon_logo.png';

                // ç”Ÿæˆå¡ç‰‡HTMLï¼Œå¯¹æ‰€æœ‰ç”¨æˆ·è¾“å…¥è¿›è¡Œè½¬ä¹‰ä»¥é˜²æ­¢XSSæ”»å‡»
                // æ·»åŠ data-item-pathå±æ€§ç”¨äºåç»­æ£€æŸ¥ä¸Šä¼ æ ‡è®°æ–‡ä»¶
                return `
                    <div class="workshop-card" data-item-path="${encodeURIComponent(item.path)}">
                        <div class="card-header">
                            <img src="${previewUrl}" alt="${escapeHtml(item.name || (window.t ? window.t('steam.localItem') : 'æœ¬åœ°ç‰©å“'))}" class="card-image">
                            <div class="status-badge ${statusClass}">${statusText}</div>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">${escapeHtml(item.name || (window.t ? window.t('steam.unnamedItem') : 'æœªå‘½åç‰©å“'))}</h3>
                            <div class="card-info-grid">
                                <div class="card-info-item"><span class="info-label">${window.t ? window.t('steam.modified_date') : 'ä¿®æ”¹æ—¥æœŸ'}</span> <span class="info-value">${formatDate(item.lastModified)}</span></div>
                                  <div class="card-info-item"><span class="info-label">${window.t ? window.t('steam.size') : 'å¤§å°'}</span> <span class="info-value">${formatFileSize(item.size)}</span></div>
                            </div>

                             
                            ${!isPublished ? `
                                <div class="card-actions">
                                    <button class="button button-primary" onclick="prepareItemForUpload('${escapeHtml(item.id).replace(/'/g, '&#39;')}', '${encodeURIComponent(item.path.replace(/\\/g, '/'))}')">${window.t ? window.t('steam.upload_to_workshop') : 'ä¸Šä¼ è‡³Workshop'}</button>
                                </div>` : `
                                <div class="card-actions">
                                    <button class="button button-disabled" disabled>${window.t ? window.t('steam.status.published') : 'å·²å‘å¸ƒ'}</button>
                                </div>
                            `}
                        </div>
                    </div>
                `;
            }).join('');

            // ç”Ÿæˆå¡ç‰‡åï¼Œæ£€æŸ¥æ¯ä¸ªç‰©å“çš„ä¸Šä¼ æ ‡è®°æ–‡ä»¶çŠ¶æ€
            checkUploadStatusForLocalItems();
        }

        // æ£€æŸ¥æœ¬åœ°ç‰©å“çš„ä¸Šä¼ æ ‡è®°æ–‡ä»¶çŠ¶æ€
        function checkUploadStatusForLocalItems() {
            // è·å–æ‰€æœ‰ç‰©å“å¡ç‰‡
            const itemCards = document.querySelectorAll('.workshop-card');

            itemCards.forEach(card => {
                const itemPath = card.getAttribute('data-item-path');
                if (itemPath) {
                    // è°ƒç”¨åç«¯APIæ£€æŸ¥ä¸Šä¼ æ ‡è®°æ–‡ä»¶
                    fetch(`/api/steam/workshop/check-upload-status?item_path=${itemPath}`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTPé”™è¯¯ï¼ŒçŠ¶æ€ç : ${response.status}`);
                            }
                            return response.json();
                        })
                        .then(data => {
                            if (data.success && data.is_published) {
                                // å¦‚æœå­˜åœ¨ä¸Šä¼ æ ‡è®°æ–‡ä»¶ï¼Œæ›´æ–°çŠ¶æ€ä¸ºå·²å‘å¸ƒ
                                const statusBadge = card.querySelector('.status-badge');
                                if (statusBadge) {
                                    statusBadge.className = 'status-badge status-published';
                                    statusBadge.textContent = window.t ? window.t('steam.status.published') : 'å·²å‘å¸ƒ';
                                }

                                // æ›´æ–°ä¸Šä¼ æŒ‰é’®çŠ¶æ€ä¸ºå·²å‘å¸ƒ
                                const actionButton = card.querySelector('.card-actions button');
                                if (actionButton) {
                                    actionButton.className = 'button button-disabled';
                                    actionButton.disabled = true;
                                    actionButton.textContent = window.t ? window.t('steam.status.published') : 'å·²å‘å¸ƒ';
                                }
                            }
                        })
                        .catch(error => {
                            console.error('æ£€æŸ¥ä¸Šä¼ æ ‡è®°æ–‡ä»¶å¤±è´¥:', error);
                        });
                }
            });
        }

        // å‡†å¤‡ç‰©å“ä¸Šä¼ 
        function prepareItemForUpload(itemId, folderPath) {
            // ç¡®ä¿è·¯å¾„æ ¼å¼ä¸€è‡´ï¼ˆå°†Windowsåæ–œæ è½¬æ¢ä¸ºæ­£æ–œæ ä»¥ä¾¿æ­£ç¡®ç¼–ç ï¼‰
            const normalizedPath = folderPath.replace(/\\/g, '/');
            // è°ƒç”¨APIè·å–ç‰©å“è¯¦æƒ…
            fetch(`/api/steam/workshop/local-items/${itemId}?folder_path=${encodeURIComponent(normalizedPath)}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTPé”™è¯¯ï¼ŒçŠ¶æ€ç : ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        const item = data.item;

                        // å¡«å……ä¸Šä¼ è¡¨å•
                        document.getElementById('item-title').value = item.name || '';
                        document.getElementById('content-folder').value = item.path || '';

                        // å¦‚æœæœ‰é¢„è§ˆå›¾ç‰‡ï¼Œå¡«å……é¢„è§ˆå›¾ç‰‡è·¯å¾„
                        if (item.previewImage) {
                            document.getElementById('preview-image').value = item.previewImage;
                        }

                        // åˆ‡æ¢åˆ°ä¸Šä¼ åŒºåŸŸ
                        toggleUploadSection();

                        showMessage(window.t ? window.t('steam.itemDetailsLoaded') : 'ç‰©å“è¯¦æƒ…åŠ è½½æˆåŠŸ', 'success');
                    } else {
                        showMessage(window.t ? window.t('steam.itemDetailsFailed', { error: data.error || (window.t ? window.t('common.unknownError') : 'æœªçŸ¥é”™è¯¯') }) : `ç‰©å“è¯¦æƒ…åŠ è½½å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    }
                })
                .catch(error => {
                    console.error('å‡†å¤‡ä¸Šä¼ å¤±è´¥:', error);
                    showMessage(window.t ? window.t('steam.prepareUploadError', { error: error.message }) : `å‡†å¤‡ä¸Šä¼ å‡ºé”™: ${error.message}`, 'error');
                });
        }

        // å¿«é€Ÿä¸Šä¼ ç‰©å“
        async function quickUploadItem(event, itemId, folderPath) {
            let button = null;
            try {
                // æ˜¾ç¤ºä¸Šä¼ ä¸­çŠ¶æ€
                button = event?.target || null;
                if (button) {
                    button.disabled = true;
                    button.innerHTML = '<i class="fa fa-spinner fa-spin"></i> ä¸Šä¼ ä¸­...';
                }

                // æ˜¾ç¤ºè·¯å¾„éªŒè¯é€šçŸ¥
                showMessage(window.t ? window.t('steam.validatingFolder', { path: folderPath }) : `æ­£åœ¨éªŒè¯æ–‡ä»¶å¤¹: ${folderPath}`, 'info');

                // å¢å¼ºçš„è·¯å¾„è§„èŒƒåŒ–ï¼Œæ”¯æŒWindowså’Œå…¶ä»–ç³»ç»Ÿ
                const normalizedPath = folderPath.replace(/\\/g, '/');

                // è°ƒç”¨APIè·å–ç‰©å“è¯¦æƒ…ï¼Œè¿™é‡Œä¼šè¿›è¡ŒæœåŠ¡å™¨ç«¯è·¯å¾„éªŒè¯
                const itemResponse = await fetch(`/api/steam/workshop/local-items/${itemId}?folder_path=${encodeURIComponent(normalizedPath)}`);
                if (!itemResponse.ok) {
                    throw new Error(`HTTPé”™è¯¯ï¼ŒçŠ¶æ€ç : ${itemResponse.status}`);
                }

                const itemData = await itemResponse.json();
                if (!itemData.success) {
                    throw new Error(`è·å–ç‰©å“è¯¦æƒ…å¤±è´¥: ${itemData.error || 'æœªçŸ¥é”™è¯¯'}`);
                }

                const item = itemData.item;

                // æ£€æŸ¥é¢„è§ˆå›¾ç‰‡æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™å°è¯•æŸ¥æ‰¾
                let previewImage = item.previewImage;
                if (!previewImage || !await doesFileExist(previewImage)) {
                    previewImage = await findPreviewImage(item.path);
                    if (!previewImage) {
                        showMessage(window.t ? window.t('steam.previewImageNotFound') : 'æœªæ‰¾åˆ°é¢„è§ˆå›¾ç‰‡', 'warning');
                    }
                }

                // ç¡®ä¿é¢„è§ˆå›¾ç‰‡è·¯å¾„æ ¼å¼ä¸€è‡´
                if (previewImage) {
                    previewImage = previewImage.replace(/\\/g, '/');
                }

                // æ„å»ºå¿«é€Ÿä¸Šä¼ æ•°æ®
                const uploadData = {
                    title: item.name || 'æœªå‘½åç‰©å“',
                    description: `é€šè¿‡N.E.K.Oå¿«é€Ÿä¸Šä¼ äº ${formatDate(new Date())}`,
                    content_folder: item.path,
                    preview_image: previewImage || '',
                    visibility: 0, // é»˜è®¤å…¬å¼€
                    tags: item.tags || ['æ¨¡ç»„'],
                    allow_comments: true
                };

                // å‘é€APIè¯·æ±‚
                const publishResponse = await fetch('/api/steam/workshop/publish', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(uploadData)
                });

                if (!publishResponse.ok) {
                    throw new Error(`HTTPé”™è¯¯ï¼ŒçŠ¶æ€ç : ${publishResponse.status}`);
                }

                const publishData = await publishResponse.json();
                if (publishData.success) {
                    showMessage(window.t ? window.t('steam.quickUploadSuccess', { id: publishData.published_file_id }) : `å¿«é€Ÿä¸Šä¼ æˆåŠŸï¼ID: ${publishData.published_file_id}`, 'success');

                    // æ›´æ–°æœ¬åœ°æ•°æ®ç¼“å­˜
                    if (item.publishDate) {
                        item.publishDate = new Date();
                    }
                    item.publishedFileId = publishData.published_file_id;

                    // é‡æ–°æ‰«æä»¥æ›´æ–°çŠ¶æ€
                    setTimeout(() => {
                        scanLocalItems();
                    }, 1000);
                } else {
                    throw new Error(`å‘å¸ƒå¤±è´¥: ${publishData.error || 'æœªçŸ¥é”™è¯¯'}`);
                }
            } catch (error) {
                showMessage(window.t ? window.t('steam.uploadFailed', { error: error.message }) : `ä¸Šä¼ å¤±è´¥: ${error.message}`, 'error');
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                if (button) {
                    button.disabled = false;
                    button.innerHTML = '<i class="fa fa-rocket"></i> å¿«é€Ÿä¸Šä¼ ';
                }
            }
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        /* æ³¨é‡Šæ‰ä¸å®Œæ•´çš„formatDateç‰ˆæœ¬ */
        /*
        function formatDate(timestamp) {
            if (!timestamp) return 'æœªçŸ¥';
            
            const date = new Date(timestamp);
            return date.toLocaleDateString();
        }
        */

        // æ·»åŠ å®Œæ•´ç‰ˆæœ¬çš„formatDateå‡½æ•°ï¼ˆåŒ…å«æ—¥æœŸå’Œæ—¶é—´ï¼‰
        function formatDate(timestamp) {
            if (!timestamp) return 'æœªçŸ¥';

            const date = new Date(timestamp);
            // ä½¿ç”¨toLocaleStringåŒæ—¶æ˜¾ç¤ºæ—¥æœŸå’Œæ—¶é—´
            return date.toLocaleString();
        }

        // æ–‡ä»¶è·¯å¾„é€‰æ‹©è¾…åŠ©åŠŸèƒ½
        function validatePathInput(elementId) {
            const element = document.getElementById(elementId);
            element.addEventListener('blur', function () {
                const path = this.value.trim();
                if (path && path.includes('\\\\')) {
                    // å°†åŒåæ–œæ æ›¿æ¢ä¸ºå•åæ–œæ ï¼ŒWindowsè·¯å¾„æ ¼å¼
                    this.value = path.replace(/\\\\/g, '\\');
                }
            });
        }

        // ä¸ºè·¯å¾„è¾“å…¥æ¡†æ·»åŠ éªŒè¯
        validatePathInput('content-folder');
        validatePathInput('preview-image');

        // æ ‡ç­¾ç®¡ç†åŠŸèƒ½
        const tagInput = document.getElementById('item-tags');
        const tagsContainer = document.getElementById('tags-container');

        tagInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && tagInput.value.trim() !== '') {
                e.preventDefault();
                addTag(tagInput.value.trim());
                tagInput.value = '';
            }
        });

        function addTag(tagText) {
            // è·å–æ ‡ç­¾å®¹å™¨å…ƒç´ 
            const tagsContainer = document.getElementById('tags-container');
            if (!tagsContainer) {
                console.error('Tags container not found');
                return;
            }

            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒæ ‡ç­¾
            const existingTags = Array.from(tagsContainer.querySelectorAll('.tag')).map(tag =>
                tag.textContent.replace('Ã—', '').trim()
            );

            if (existingTags.includes(tagText)) {
                showMessage(window.t ? window.t('steam.tagExists') : 'è¯¥æ ‡ç­¾å·²å­˜åœ¨', 'error');
                return;
            }

            const tagElement = document.createElement('div');
            tagElement.className = 'tag';
            tagElement.innerHTML = `${tagText}<span class="tag-remove" onclick="removeTag(this)">Ã—</span>`;
            tagsContainer.appendChild(tagElement);
        }

        function removeTag(tagElement) {
            tagElement.parentElement.remove();
        }

        // æ¶ˆæ¯æ˜¾ç¤ºåŠŸèƒ½ - å¢å¼ºç‰ˆ
        function showMessage(message, type = 'info', duration = 3000) {
            const messageArea = document.getElementById('message-area') || createMessageArea();
            const messageElement = document.createElement('div');

            // åˆ›å»ºæ¶ˆæ¯å®¹å™¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
            function createMessageArea() {
                const container = document.createElement('div');
                container.id = 'message-area';
                container.className = 'message-area';
                document.body.appendChild(container);
                return container;
            }

            // æ¶ˆæ¯ç±»å‹å’Œå›¾æ ‡æ˜ å°„
            const typeConfig = {
                error: { className: 'error-message', icon: 'fa-exclamation-circle' },
                warning: { className: 'warning-message', icon: 'fa-exclamation-triangle' },
                success: { className: 'success-message', icon: 'fa-check-circle' },
                info: { className: 'info-message', icon: 'fa-info-circle' }
            };

            // è·å–å½“å‰æ¶ˆæ¯ç±»å‹çš„é…ç½®
            const config = typeConfig[type] || typeConfig.info;

            // è®¾ç½®æ ·å¼ç±»
            messageElement.className = config.className;

            // è®¾ç½®æ¶ˆæ¯å†…å®¹ï¼Œæ·»åŠ å›¾æ ‡å’ŒHTMLè½¬ä¹‰
            messageElement.innerHTML = `
                <i class="fa ${config.icon}" style="margin-right: 8px;"></i>
                <span>${escapeHtml(message)}</span>
            `;

            // æ·»åŠ å…³é—­æŒ‰é’®
            const closeButton = document.createElement('span');
            closeButton.className = 'message-close';
            closeButton.innerHTML = '<i class="fa fa-times"></i>';
            closeButton.onclick = () => messageElement.remove();
            messageElement.appendChild(closeButton);

            // ä¸ºé”™è¯¯æ¶ˆæ¯æ·»åŠ è¯¦ç»†ä¿¡æ¯æ”¯æŒ
            if (type === 'error' && typeof message === 'object') {
                messageElement.title = JSON.stringify(message, null, 2);
            }

            // æ·»åŠ æ¶ˆæ¯
            messageArea.appendChild(messageElement);

            // è®¾ç½®åˆå§‹æ ·å¼
            messageElement.style.opacity = '0';
            messageElement.style.transform = 'translateY(-10px)';
            messageElement.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            messageElement.style.display = 'flex';
            messageElement.style.alignItems = 'center';
            messageElement.style.padding = '10px 15px';
            messageElement.style.marginBottom = '10px';
            messageElement.style.borderRadius = '4px';
            messageElement.style.position = 'relative';
            messageElement.style.zIndex = '1000';

            // ä¸ºä¸åŒç±»å‹è®¾ç½®èƒŒæ™¯è‰²
            const bgColors = {
                error: '#ffebee',
                warning: '#fff8e1',
                success: '#e8f5e9',
                info: '#e3f2fd'
            };
            messageElement.style.backgroundColor = bgColors[type] || '#f5f5f5';

            // è®¾ç½®æ¶ˆæ¯æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                messageElement.style.opacity = '1';
                messageElement.style.transform = 'translateY(0)';
            }, 10);

            // ç¡®ä¿æ¶ˆæ¯åŒºåŸŸåœ¨é¡µé¢é¡¶éƒ¨ä¸”å›ºå®š
            messageArea.style.position = 'fixed';
            messageArea.style.top = '20px';
            messageArea.style.right = '20px';
            messageArea.style.maxWidth = '400px';
            messageArea.style.zIndex = '99999'; // å¢åŠ z-indexç¡®ä¿æ˜¾ç¤ºåœ¨æœ€é¡¶å±‚
            messageArea.style.display = 'flex';
            messageArea.style.flexDirection = 'column';
            messageArea.style.alignItems = 'flex-end';
            messageArea.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)'; // æ·»åŠ é˜´å½±å¢å¼ºå¯è§æ€§

            // å…³é—­æŒ‰é’®æ ·å¼
            closeButton.style.position = 'absolute';
            closeButton.style.right = '10px';
            closeButton.style.cursor = 'pointer';
            closeButton.style.fontSize = '16px';
            closeButton.style.border = 'none';
            closeButton.style.background = 'none';
            closeButton.style.padding = '2px 5px';
            closeButton.style.borderRadius = '3px';
            closeButton.onmouseover = function () { this.style.backgroundColor = 'rgba(0,0,0,0.1);' };
            closeButton.onmouseout = function () { this.style.backgroundColor = 'transparent;' };

            // è‡ªåŠ¨æ¸…é™¤æ¶ˆæ¯ï¼ˆå¦‚æœæŒ‡å®šäº†æŒç»­æ—¶é—´ï¼‰
            if (duration > 0) {
                setTimeout(() => {
                    messageElement.style.opacity = '0';
                    messageElement.style.transform = 'translateY(-10px)';
                    setTimeout(() => {
                        messageElement.remove();
                    }, 300);
                }, duration);
            }
        }

        // HTMLè½¬ä¹‰å‡½æ•°
        function escapeHtml(text) {
            if (typeof text !== 'string') {
                return String(text);
            }
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // åŠ è½½çŠ¶æ€ç®¡ç†å™¨
        function LoadingManager() {
            const loadingCount = { value: 0 };

            return {
                show: function (message = window.t ? window.t('common.loading') : 'åŠ è½½ä¸­...') {
                    loadingCount.value++;
                    if (loadingCount.value === 1) {
                        const loadingOverlay = document.createElement('div');
                        loadingOverlay.id = 'loading-overlay';
                        loadingOverlay.style.cssText = `
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background: rgba(255, 255, 255, 0.8);
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            justify-content: center;
                            z-index: 9999;
                            backdrop-filter: blur(2px);
                        `;

                        const loadingSpinner = document.createElement('div');
                        loadingSpinner.style.cssText = `
                            border: 4px solid #f3f3f3;
                            border-top: 4px solid #3498db;
                            border-radius: 50%;
                            width: 40px;
                            height: 40px;
                            animation: spin 1s linear infinite;
                            margin-bottom: 15px;
                        `;

                        const loadingText = document.createElement('div');
                        loadingText.textContent = message;
                        loadingText.style.fontSize = '16px';
                        loadingText.style.color = '#333';

                        // æ·»åŠ CSSåŠ¨ç”»
                        const style = document.createElement('style');
                        style.textContent = `
                            @keyframes spin {
                                0% { transform: rotate(0deg); }
                                100% { transform: rotate(360deg); }
                            }
                        `;

                        loadingOverlay.appendChild(loadingSpinner);
                        loadingOverlay.appendChild(loadingText);
                        document.body.appendChild(loadingOverlay);
                        document.body.appendChild(style);
                    }
                },

                hide: function () {
                    loadingCount.value--;
                    if (loadingCount.value <= 0) {
                        loadingCount.value = 0;
                        const overlay = document.getElementById('loading-overlay');
                        if (overlay) {
                            overlay.remove();
                        }
                    }
                }
            };
        }

        // åˆ›å»ºå…¨å±€åŠ è½½ç®¡ç†å™¨å®ä¾‹
        const loading = new LoadingManager();

        // è¡¨å•éªŒè¯å‡½æ•°
        function validateForm() {
            let isValid = true;
            const errorMessages = [];

            // éªŒè¯æ ‡é¢˜
            const title = document.getElementById('item-title').value.trim();
            if (!title) {
                errorMessages.push(window.t ? window.t('steam.titleRequired') : 'è¯·è¾“å…¥æ ‡é¢˜');
                document.getElementById('item-title').classList.add('error');
                isValid = false;
            } else {
                document.getElementById('item-title').classList.remove('error');
            }

            // éªŒè¯å†…å®¹æ–‡ä»¶å¤¹
            const contentFolder = document.getElementById('content-folder').value.trim();
            if (!contentFolder) {
                errorMessages.push(window.t ? window.t('steam.contentFolderRequired') : 'è¯·æŒ‡å®šå†…å®¹æ–‡ä»¶å¤¹');
                document.getElementById('content-folder').classList.add('error');
                isValid = false;
            } else {
                // ç®€å•çš„è·¯å¾„æ ¼å¼éªŒè¯
                if (/^[a-zA-Z]:\\/.test(contentFolder) || /^\//.test(contentFolder) || /^\.\.?[\\\/]/.test(contentFolder)) {
                    document.getElementById('content-folder').classList.remove('error');
                } else {
                    errorMessages.push(window.t ? window.t('invalidFolderFormat') : 'å†…å®¹æ–‡ä»¶å¤¹è·¯å¾„æ ¼å¼ä¸æ­£ç¡®');
                    document.getElementById('content-folder').classList.add('error');
                    isValid = false;
                }
            }

            // éªŒè¯é¢„è§ˆå›¾ç‰‡
            const previewImage = document.getElementById('preview-image').value.trim();
            if (!previewImage) {
                errorMessages.push(window.t ? window.t('steam.previewImageRequired') : 'è¯·ä¸Šä¼ é¢„è§ˆå›¾ç‰‡');
                document.getElementById('preview-image').classList.add('error');
                isValid = false;
            } else {
                // éªŒè¯å›¾ç‰‡æ ¼å¼
                const imageExtRegex = /\.(jpg|jpeg|png)$/i;
                if (!imageExtRegex.test(previewImage)) {
                    errorMessages.push(window.t ? window.t('steam.previewImageFormat') : 'é¢„è§ˆå›¾ç‰‡æ ¼å¼å¿…é¡»ä¸ºPNGã€JPGæˆ–JPEG');
                    document.getElementById('preview-image').classList.add('error');
                    isValid = false;
                } else {
                    document.getElementById('preview-image').classList.remove('error');
                }
            }

            // æ˜¾ç¤ºéªŒè¯é”™è¯¯æ¶ˆæ¯
            if (errorMessages.length > 0) {
                showMessage(errorMessages.join('\n'), 'error', 5000);
            }

            return isValid;
        }

        // ç¦ç”¨/å¯ç”¨æŒ‰é’®å‡½æ•°
        function setButtonState(buttonElement, isDisabled) {
            if (buttonElement) {
                buttonElement.disabled = isDisabled;
                if (isDisabled) {
                    buttonElement.classList.add('button-disabled');
                } else {
                    buttonElement.classList.remove('button-disabled');
                }
            }
        }

        // ä¸Šä¼ ç‰©å“åŠŸèƒ½
        function uploadItem() {
            // è·å–è·¯å¾„
            let contentFolder = document.getElementById('content-folder').value.trim();
            let previewImage = document.getElementById('preview-image').value.trim();

            if (!contentFolder) {
                showMessage(window.t ? window.t('steam.enterContentFolderPath') : 'è¯·è¾“å…¥å†…å®¹æ–‡ä»¶å¤¹è·¯å¾„', 'error');
                document.getElementById('content-folder').focus();
                return;
            }

            // å¢å¼ºçš„è·¯å¾„è§„èŒƒåŒ–å¤„ç†
            contentFolder = contentFolder.replace(/\\/g, '/');
            if (previewImage) {
                previewImage = previewImage.replace(/\\/g, '/');
            }

            // æ˜¾ç¤ºè·¯å¾„éªŒè¯é€šçŸ¥
            showMessage(window.t ? window.t('steam.validatingFolderPath', { path: contentFolder }) : `æ­£åœ¨éªŒè¯æ–‡ä»¶å¤¹è·¯å¾„: ${contentFolder}`, 'info');

            // å¦‚æœæ²¡æœ‰é¢„è§ˆå›¾ç‰‡ï¼Œä»ç„¶å…è®¸ç»§ç»­ä¸Šä¼ ï¼Œåç«¯ä¼šå°è¯•è‡ªåŠ¨æŸ¥æ‰¾æˆ–ä½¿ç”¨é»˜è®¤æœºåˆ¶
            if (!previewImage) {
                showMessage(window.t ? window.t('steam.previewImageNotProvided') : 'æœªæä¾›é¢„è§ˆå›¾ç‰‡ï¼Œç³»ç»Ÿå°†å°è¯•è‡ªåŠ¨ç”Ÿæˆ', 'warning');
            }

            // éªŒè¯è¡¨å•
            if (!validateForm()) {
                return;
            }

            // æ”¶é›†è¡¨å•æ•°æ®
            const title = document.getElementById('item-title')?.value.trim() || '';
            const description = document.getElementById('item-description')?.value.trim() || '';
            // å†…å®¹æ–‡ä»¶å¤¹å’Œé¢„è§ˆå›¾ç‰‡è·¯å¾„å·²ç»åœ¨ä¸Šé¢å®šä¹‰è¿‡äº†ï¼Œä¸å†é‡å¤å®šä¹‰
            const visibilitySelect = document.getElementById('visibility');
            const allowComments = document.getElementById('allow-comments')?.checked || false;

            // æ”¶é›†æ ‡ç­¾
            let tags = [];
            const tagElements = document.querySelectorAll('#tags-container .tag');
            if (tagElements && tagElements.length > 0) {
                tags = Array.from(tagElements)
                    .filter(tag => tag && tag.textContent)
                    .map(tag => tag.textContent.replace('Ã—', '').trim())
                    .filter(tag => tag); // è¿‡æ»¤ç©ºæ ‡ç­¾
            }

            // è½¬æ¢å¯è§æ€§é€‰é¡¹ä¸ºæ•°å€¼
            let visibility = 0; // é»˜è®¤å…¬å¼€
            if (visibilitySelect) {
                const value = visibilitySelect.value;
                if (value === 'friends') {
                    visibility = 1;
                } else if (value === 'private') {
                    visibility = 2;
                }
            }

            // å‡†å¤‡ä¸Šä¼ æ•°æ®
            const uploadData = {
                title: title,
                description: description,
                content_folder: contentFolder,
                preview_image: previewImage,
                visibility: visibility,
                tags: tags,
                allow_comments: allowComments
            };

            // è·å–ä¸Šä¼ æŒ‰é’®å¹¶ç¦ç”¨
            const uploadButton = document.querySelector('.upload-section button.button');
            let originalText = '';
            if (uploadButton) {
                originalText = uploadButton.textContent || '';
                uploadButton.textContent = window.t ? window.t('common.loading') : 'Uploading...';
                setButtonState(uploadButton, true);
            }

            // æ˜¾ç¤ºä¸Šä¼ ä¸­æ¶ˆæ¯
            showMessage(window.t ? window.t('steam.preparingUpload') : 'æ­£åœ¨å‡†å¤‡ä¸Šä¼ ...', 'success', 0); // 0è¡¨ç¤ºä¸è‡ªåŠ¨å…³é—­

            // å‘é€APIè¯·æ±‚
            fetch('/api/steam/workshop/publish', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(uploadData)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTPé”™è¯¯ï¼ŒçŠ¶æ€ç : ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    if (uploadButton) {
                        uploadButton.textContent = originalText;
                        setButtonState(uploadButton, false);
                    }

                    // æ¸…é™¤æ‰€æœ‰ç°æœ‰æ¶ˆæ¯
                    const messageArea = document.getElementById('message-area');
                    if (messageArea) {
                        messageArea.innerHTML = '';
                    }

                    if (data.success) {
                        showMessage(window.t ? window.t('steam.uploadSuccess') : 'ä¸Šä¼ æˆåŠŸï¼', 'success', 5000);

                        // æ˜¾ç¤ºç‰©å“ID
                        if (data.published_file_id) {
                            showMessage(window.t ? window.t('steam.itemId', { id: data.published_file_id }) : `ç‰©å“ID: ${data.published_file_id}`, 'success', 5000);

                            // ä½¿ç”¨Steam overlayæ‰“å¼€ç‰©å“é¡µé¢
                            try {
                                const published_id = data.published_file_id;
                                const url = `steam://url/CommunityFilePage/${published_id}`;

                                // æ£€æŸ¥æ˜¯å¦æ”¯æŒSteam overlay
                                if (window.steam && typeof window.steam.ActivateGameOverlayToWebPage === 'function') {
                                    window.steam.ActivateGameOverlayToWebPage(url);
                                } else {
                                    // å¤‡é€‰æ–¹æ¡ˆï¼šå°è¯•ç›´æ¥æ‰“å¼€URL
                                    window.open(url);
                                }
                            } catch (e) {
                                console.error('æ— æ³•æ‰“å¼€Steam overlay:', e);
                            }
                        }

                        // å¦‚æœéœ€è¦æ¥å—åè®®
                        if (data.needs_to_accept_agreement) {
                            showMessage(window.t ? window.t('steam.workshopAgreementRequired') : 'è¯·å…ˆåŒæ„Steam Workshopä½¿ç”¨åè®®', 'warning', 8000);
                        }

                        // æ¸…ç©ºè¡¨å•
                        const formElements = [
                            { id: 'item-title', property: 'value', value: '' },
                            { id: 'item-description', property: 'value', value: '' },
                            { id: 'content-folder', property: 'value', value: '' },
                            { id: 'preview-image', property: 'value', value: '' },
                            { id: 'visibility', property: 'value', value: 'public' },
                            { id: 'allow-comments', property: 'checked', value: true }
                        ];

                        formElements.forEach(element => {
                            const el = document.getElementById(element.id);
                            if (el) {
                                el[element.property] = element.value;
                            }
                        });

                        // æ¸…ç©ºæ ‡ç­¾
                        const tagsContainer = document.getElementById('tags-container');
                        if (tagsContainer) {
                            tagsContainer.innerHTML = '';
                        }

                        // æ·»åŠ é»˜è®¤æ ‡ç­¾
                        addTag('æ¨¡ç»„');

                        // æ˜¾ç¤ºæˆåŠŸæç¤ºå’Œæ“ä½œé€‰é¡¹
                        setTimeout(() => {
                            const messageArea = document.getElementById('message-area');
                            const actionMessage = document.createElement('div');
                            actionMessage.className = 'success-message';
                            actionMessage.innerHTML = `
                            <span>${window.t ? window.t('steam.operationComplete') : 'Operation complete, you can:'}</span>
                            <button class="button button-sm" onclick="document.getElementById('item-title').focus()">${window.t ? window.t('steam.continueUpload') : 'Continue Uploading'}</button>
                            <button class="button button-sm" onclick="toggleUploadSection()">${window.t ? window.t('steam.hideUploadSection') : 'Hide Upload Section'}</button>
                            <span class="message-close" onclick="this.parentElement.remove()">Ã—</span>
                        `;
                            messageArea.appendChild(actionMessage);
                        }, 1000);
                    } else {
                        showMessage(window.t ? window.t('steam.uploadError', { error: data.error || (window.t ? window.t('common.unknownError') : 'æœªçŸ¥é”™è¯¯') }) : `ä¸Šä¼ å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}`, 'error', 8000);
                        if (data.message) {
                            showMessage(window.t ? window.t('steam.uploadWarning', { message: data.message }) : `è­¦å‘Š: ${data.message}`, 'warning', 8000);
                        }

                        // æä¾›é‡è¯•å»ºè®®
                        setTimeout(() => {
                            const retryButton = document.createElement('button');
                            retryButton.className = 'button button-sm';
                            retryButton.textContent = 'é‡è¯•ä¸Šä¼ ';
                            retryButton.onclick = uploadItem;

                            const messageArea = document.getElementById('message-area');
                            const retryMessage = document.createElement('div');
                            retryMessage.className = 'error-message';
                            retryMessage.innerHTML = `<span>${window.t ? window.t('steam.retryPrompt') : 'Would you like to retry the upload?'}</span>
                            <button class="button button-sm" onclick="uploadItem()">${window.t ? window.t('steam.retryUpload') : 'Retry Upload'}</button>
                            <span class="message-close" onclick="this.parentElement.remove()">Ã—</span>`;
                            messageArea.appendChild(retryMessage);
                        }, 2000);
                    }
                })
                .catch(error => {
                    console.error('ä¸Šä¼ å¤±è´¥:', error);

                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    if (uploadButton) {
                        uploadButton.textContent = originalText;
                        setButtonState(uploadButton, false);
                    }

                    // æ¸…é™¤æ‰€æœ‰ç°æœ‰æ¶ˆæ¯
                    const messageArea = document.getElementById('message-area');
                    if (messageArea) {
                        messageArea.innerHTML = '';
                    }

                    let errorMessage = window.t ? window.t('steam.uploadGeneralError') : 'ä¸Šä¼ å¤±è´¥';

                    // æ ¹æ®é”™è¯¯ç±»å‹æä¾›æ›´å…·ä½“çš„æç¤º
                    if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                        errorMessage = window.t ? window.t('steam.uploadNetworkError') : 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥æ‚¨çš„è¿æ¥';
                        showMessage(window.t ? window.t('steam.uploadErrorFormat', { message: errorMessage }) : errorMessage, 'error', 8000);
                        showMessage(window.t ? window.t('steam.checkNetworkConnection') : 'è¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥', 'warning', 8000);
                    } else if (error.message.includes('HTTPé”™è¯¯')) {
                        errorMessage = window.t ? window.t('steam.uploadHttpError', { error: error.message }) : `HTTPé”™è¯¯: ${error.message}`;
                        showMessage(window.t ? window.t('steam.uploadErrorFormat', { message: errorMessage }) : errorMessage, 'error', 8000);
                        showMessage(window.t ? window.t('steam.serverProblem', { message: window.t ? window.t('common.tryAgainLater') : 'è¯·ç¨åé‡è¯•' }) : 'æœåŠ¡å™¨é—®é¢˜ï¼Œè¯·ç¨åé‡è¯•', 'warning', 8000);
                    } else {
                        showMessage(window.t ? window.t('steam.uploadErrorFormat', { message: window.t ? window.t('steam.uploadErrorWithMessage', { error: error.message }) : `é”™è¯¯: ${error.message}` }) : `é”™è¯¯: ${error.message}`, 'error', 8000);
                    }
                });
        }

        // åˆ†é¡µç›¸å…³å˜é‡
        let allSubscriptions = []; // å­˜å‚¨æ‰€æœ‰è®¢é˜…ç‰©å“
        let currentPage = 1;
        let itemsPerPage = 10;
        let totalPages = 1;
        let currentSortField = 'timeAdded'; // é»˜è®¤æŒ‰æ·»åŠ æ—¶é—´æ’åº
        let currentSortOrder = 'desc'; // é»˜è®¤é™åº

        // åŠ è½½è®¢é˜…ç‰©å“
        function loadSubscriptions() {
            const subscriptionsList = document.getElementById('subscriptions-list');
            subscriptionsList.innerHTML = `<div class="empty-state"><p>${window.t ? window.t('steam.loadingSubscriptions') : 'æ­£åœ¨åŠ è½½æ‚¨çš„è®¢é˜…ç‰©å“...'}</p></div>`;

            // è°ƒç”¨åç«¯APIè·å–è®¢é˜…ç‰©å“åˆ—è¡¨
            fetch('/api/steam/workshop/subscribed-items')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (!data.success) {
                        subscriptionsList.innerHTML = `<div class="empty-state"><p>${window.t ? window.t('steam.fetchFailed') : 'Failed to fetch subscribed items'}: ${data.error || (window.t ? window.t('common.unknownError') : 'Unknown error')}</p></div>`;
                        // å¦‚æœæœ‰æ¶ˆæ¯æç¤ºï¼Œæ˜¾ç¤ºç»™ç”¨æˆ·
                        if (data.message) {
                            showMessage(data.message, 'error');
                        }
                        updatePagination(); // æ›´æ–°åˆ†é¡µçŠ¶æ€
                        return;
                    }

                    // ä¿å­˜æ‰€æœ‰è®¢é˜…ç‰©å“åˆ°å…¨å±€å˜é‡
                    allSubscriptions = data.items || [];

                    // åº”ç”¨æ’åºï¼ˆä»ä¸‹æ‹‰æ¡†è·å–æ’åºæ–¹å¼ï¼‰
                    const sortSelect = document.getElementById('sort-subscription');
                    if (sortSelect) {
                        const [field, order] = sortSelect.value.split('_');
                        sortSubscriptions(field, order);
                    } else {
                        // é»˜è®¤æŒ‰æ—¥æœŸé™åºæ’åº
                        sortSubscriptions('date', 'desc');
                    }

                    // è®¡ç®—æ€»é¡µæ•°
                    totalPages = Math.ceil(allSubscriptions.length / itemsPerPage);
                    if (totalPages < 1) totalPages = 1;
                    if (currentPage > totalPages) currentPage = totalPages;

                    // æ˜¾ç¤ºå½“å‰é¡µçš„æ•°æ®
                    renderSubscriptionsPage();

                    // æ›´æ–°åˆ†é¡µUI
                    updatePagination();
                })
                .catch(error => {
                    console.error('è·å–è®¢é˜…ç‰©å“å¤±è´¥:', error);
                    subscriptionsList.innerHTML = `<div class="empty-state"><p>${window.t ? window.t('steam.fetchFailed') : 'è·å–è®¢é˜…ç‰©å“å¤±è´¥'}: ${error.message}</p></div>`;
                    showMessage(window.t ? window.t('steam.cannotConnectToServer') : 'æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·ç¨åé‡è¯•', 'error');
                });
        }

        // æ¸²æŸ“å½“å‰é¡µçš„è®¢é˜…ç‰©å“
        function renderSubscriptionsPage() {
            const subscriptionsList = document.getElementById('subscriptions-list');

            if (allSubscriptions.length === 0) {
                subscriptionsList.innerHTML = `<div class="empty-state"><p>${window.t ? window.t('steam.noSubscriptions') : 'You haven\'t subscribed to any workshop items yet'}</p></div>`;
                return;
            }

            // è®¡ç®—å½“å‰é¡µçš„æ•°æ®èŒƒå›´
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentItems = allSubscriptions.slice(startIndex, endIndex);

            // ç”Ÿæˆå¡ç‰‡HTML
            subscriptionsList.innerHTML = currentItems.map(item => {
                // æ ¼å¼åŒ–ç‰©å“æ•°æ®ä¸ºå‰ç«¯æ‰€éœ€æ ¼å¼
                // ç¡®ä¿publishedFileIdè½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œé¿å…ç±»å‹é”™è¯¯
                const formattedItem = {
                    id: String(item.publishedFileId),
                    name: item.title || `${window.t ? window.t('steam.unknownItem') : 'æœªçŸ¥ç‰©å“'}_${String(item.publishedFileId)}`,
                    author: item.steamIDOwner ? String(item.steamIDOwner) : (window.t ? window.t('steam.unknownAuthor') : 'æœªçŸ¥ä½œè€…'), // æš‚æ—¶ä½¿ç”¨SteamIDä½œä¸ºä½œè€…å
                    subscribedDate: item.timeAdded ? new Date(item.timeAdded * 1000).toLocaleDateString() : (window.t ? window.t('steam.unknownDate') : 'æœªçŸ¥æ—¥æœŸ'),
                    lastUpdated: item.timeUpdated ? new Date(item.timeUpdated * 1000).toLocaleDateString() : (window.t ? window.t('steam.unknownDate') : 'æœªçŸ¥æ—¥æœŸ'),
                    size: formatFileSize(item.fileSizeOnDisk || item.fileSize || 0),
                    previewUrl: item.previewImageUrl || '../static/icons/Steam_icon_logo.png',
                    state: item.state || {},
                    // æ·»åŠ å®‰è£…è·¯å¾„ä¿¡æ¯
                    installedFolder: item.installedFolder || '',
                    description: item.description || 'æš‚æ— æè¿°',
                    timeAdded: item.timeAdded || 0,
                    fileSize: item.fileSizeOnDisk || item.fileSize || 0
                };

                // ç¡®å®šçŠ¶æ€ç±»å’Œæ–‡æœ¬
                let statusClass = 'status-subscribed';
                let statusText = window.t ? window.t('steam.status.subscribed') : 'å·²è®¢é˜…';

                if (formattedItem.state.downloading) {
                    statusClass = 'status-downloading';
                    statusText = window.t ? window.t('steam.status.downloading') : 'ä¸‹è½½ä¸­';
                } else if (formattedItem.state.needsUpdate) {
                    statusClass = 'status-needs-update';
                    statusText = window.t ? window.t('steam.status.needsUpdate') : 'éœ€è¦æ›´æ–°';
                } else if (formattedItem.state.installed) {
                    statusClass = 'status-installed';
                    statusText = window.t ? window.t('steam.status.installed') : 'å·²å®‰è£…';
                }

                return `
                    <div class="workshop-card">
                        <div class="card-header">
                            <img src="${formattedItem.installedFolder ? `/api/proxy-image?image_path=${encodeURIComponent(formattedItem.installedFolder + '/preview.png')}` : `/api/proxy-image?image_path=${encodeURIComponent(formattedItem.previewUrl)}`}" alt="${formattedItem.name}" class="card-image">
                            <div class="status-badge ${statusClass}">${statusText}</div>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">${formattedItem.name}</h3>
                            <div class="author-info">
                                <div class="author-avatar">${formattedItem.author.substring(0, 2).toUpperCase()}</div>
                                <span>${window.t ? window.t('steam.author') : 'ä½œè€…'}: ${formattedItem.author}</span>
                            </div>
                            <div class="card-info-grid">
                                <div class="card-info-item"><span class="info-label">${window.t ? window.t('steam.subscribed_date') : 'è®¢é˜…æ—¥æœŸ'}:</span> <span class="info-value">${formattedItem.subscribedDate}</span></div>
                                <div class="card-info-item"><span class="info-label">${window.t ? window.t('steam.last_updated') : 'æœ€åæ›´æ–°'}:</span> <span class="info-value">${formattedItem.lastUpdated}</span></div>
                                <div class="card-info-item"><span class="info-label">${window.t ? window.t('steam.size') : 'å¤§å°'}:</span> <span class="info-value">${formattedItem.size}</span></div>
                            </div>
                            ${formattedItem.state && formattedItem.state.downloading && item.downloadProgress ?
                        `<div class="download-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${item.downloadProgress.percentage}%">
                                            ${item.downloadProgress.percentage.toFixed(1)}%
                                        </div>
                                    </div>
                                </div>` : ''
                    }
                            <div class="card-actions">
                                     <!-- æŸ¥çœ‹è¯¦æƒ…ä¸‹æ¬¡å†åŠ ï¼Œä¸€æ—¶åŠä¼šå„¿æä¸å®š -->
                                <button class="button button-danger" onclick="unsubscribeItem('${formattedItem.id}', '${formattedItem.name}')">${window.t ? window.t('steam.unsubscribe') : 'å–æ¶ˆè®¢é˜…'}</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æ›´æ–°åˆ†é¡µæ§ä»¶
        function updatePagination() {
            const pagination = document.querySelector('.pagination');
            if (!pagination) return;

            const prevBtn = pagination.querySelector('button:first-child');
            const nextBtn = pagination.querySelector('button:last-child');
            const pageInfo = pagination.querySelector('span');

            // æ›´æ–°é¡µç ä¿¡æ¯
            if (pageInfo) {
                pageInfo.textContent = window.t ? window.t('steam.pagination', { currentPage: currentPage, totalPages: totalPages }) : `${currentPage} / ${totalPages}`;
            }

            // æ›´æ–°ä¸Šä¸€é¡µæŒ‰é’®çŠ¶æ€
            if (prevBtn) {
                prevBtn.disabled = currentPage <= 1;
            }

            // æ›´æ–°ä¸‹ä¸€é¡µæŒ‰é’®çŠ¶æ€
            if (nextBtn) {
                nextBtn.disabled = currentPage >= totalPages;
            }
        }

        // å‰å¾€ä¸Šä¸€é¡µ
        function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderSubscriptionsPage();
                updatePagination();
            }
        }

        // å‰å¾€ä¸‹ä¸€é¡µ
        function goToNextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                renderSubscriptionsPage();
                updatePagination();
            }
        }

        // æ’åºè®¢é˜…ç‰©å“
        function sortSubscriptions(field, order) {
            if (allSubscriptions.length <= 1) return;

            allSubscriptions.sort((a, b) => {
                let aValue, bValue;

                // æ ¹æ®ä¸åŒå­—æ®µè·å–å¯¹åº”çš„å€¼
                switch (field) {
                    case 'name':
                        aValue = (a.title || String(a.publishedFileId || '')).toLowerCase();
                        bValue = (b.title || String(b.publishedFileId || '')).toLowerCase();
                        break;
                    case 'date':
                        aValue = a.timeAdded || 0;
                        bValue = b.timeAdded || 0;
                        break;
                    case 'size':
                        aValue = a.fileSizeOnDisk || a.fileSize || 0;
                        bValue = b.fileSizeOnDisk || b.fileSize || 0;
                        break;
                    case 'update':
                        aValue = a.timeUpdated || 0;
                        bValue = b.timeUpdated || 0;
                        break;
                    default:
                        // é»˜è®¤æŒ‰åç§°æ’åº
                        aValue = (a.title || String(a.publishedFileId || '')).toLowerCase();
                        bValue = (b.title || String(b.publishedFileId || '')).toLowerCase();
                }

                // å¤„ç†ç©ºå€¼
                if (aValue === undefined || aValue === null) aValue = '';
                if (bValue === undefined || bValue === null) bValue = '';

                // å­—ç¬¦ä¸²æ¯”è¾ƒ
                if (typeof aValue === 'string') {
                    return order === 'asc' ?
                        aValue.localeCompare(bValue) :
                        bValue.localeCompare(aValue);
                }
                // æ•°å­—æ¯”è¾ƒ
                return order === 'asc' ?
                    (aValue - bValue) :
                    (bValue - aValue);
            });
        }

        // åº”ç”¨æ’åº
        function applySort(sortValue) {
            // è§£ææ’åºå€¼
            const [field, order] = sortValue.split('_');

            // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
            currentPage = 1;

            // åº”ç”¨æ’åº
            sortSubscriptions(field, order);

            // é‡æ–°æ¸²æŸ“é¡µé¢
            renderSubscriptionsPage();

            // æ›´æ–°åˆ†é¡µ
            updatePagination();
        }

        // è¿‡æ»¤è®¢é˜…ç‰©å“
        function filterSubscriptions(searchTerm) {
            // ç®€å•å®ç°è¿‡æ»¤åŠŸèƒ½
            searchTerm = searchTerm.toLowerCase().trim();

            // ä¿å­˜åŸå§‹æ•°æ®
            if (window.originalSubscriptions === undefined) {
                window.originalSubscriptions = [...allSubscriptions];
            }

            // å¦‚æœæœç´¢è¯ä¸ºç©ºï¼Œæ¢å¤åŸå§‹æ•°æ®
            if (!searchTerm) {
                if (window.originalSubscriptions) {
                    allSubscriptions = [...window.originalSubscriptions];
                }
                // é‡æ–°åº”ç”¨å½“å‰æ’åº
                const sortSelect = document.getElementById('sort-subscription');
                if (sortSelect) {
                    applySort(sortSelect.value);
                }
                return;
            }

            // è¿‡æ»¤ç‰©å“
            let itemsToFilter = window.originalSubscriptions || [...allSubscriptions];
            const filteredItems = itemsToFilter.filter(item => {
                const title = (item.title || '').toLowerCase();
                return title.includes(searchTerm);
            });

            allSubscriptions = filteredItems;

            // é‡æ–°è®¡ç®—åˆ†é¡µ
            totalPages = Math.ceil(allSubscriptions.length / itemsPerPage);
            if (totalPages < 1) totalPages = 1;
            if (currentPage > totalPages) currentPage = totalPages;

            // æ¸²æŸ“è¿‡æ»¤åçš„ç»“æœ
            renderSubscriptionsPage();
            updatePagination();
        }

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0 || bytes === undefined) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // è·å–çŠ¶æ€æ–‡æœ¬
        function getStatusText(state) {
            if (state.downloading) {
                return window.t ? window.t('steam.status.downloading') : 'ä¸‹è½½ä¸­';
            } else if (state.needsUpdate) {
                return window.t ? window.t('steam.status.needsUpdate') : 'éœ€è¦æ›´æ–°';
            } else if (state.installed) {
                return window.t ? window.t('steam.status.installed') : 'å·²å®‰è£…';
            } else if (state.subscribed) {
                return window.t ? window.t('steam.status.subscribed') : 'å·²è®¢é˜…';
            } else {
                return window.t ? window.t('steam.status.unknown') : 'æœªçŸ¥';
            }
        }

        // æ‰“å¼€æ¨¡æ€æ¡†
        function openModal() {
            const modal = document.getElementById('itemDetailsModal');
            modal.style.display = 'flex';
            // é˜»æ­¢é¡µé¢æ»šåŠ¨
            document.body.style.overflow = 'hidden';
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            const modal = document.getElementById('itemDetailsModal');
            modal.style.display = 'none';
            // æ¢å¤é¡µé¢æ»šåŠ¨
            document.body.style.overflow = 'auto';
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        function closeModalOnOutsideClick(event) {
            const modal = document.getElementById('itemDetailsModal');
            if (event.target === modal) {
                closeModal();
            }
        }


        // æŸ¥çœ‹ç‰©å“è¯¦æƒ…
        function viewItemDetails(itemId) {
            // æ˜¾ç¤ºåŠ è½½æ¶ˆæ¯
            showMessage(window.t ? window.t('steam.loadingItemDetailsWithId', { id: itemId }) : `Loading item ID: ${itemId} details...`, 'success');

            // è°ƒç”¨åç«¯APIè·å–ç‰©å“è¯¦æƒ…
            fetch(`/api/steam/workshop/item/${itemId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (!data.success) {
                        showMessage(window.t ? window.t('steam.itemDetailsFailed', { error: data.error || (window.t ? window.t('common.unknownError') : 'Unknown error') }) : `Failed to get item details: ${data.error || 'Unknown error'}`, 'error');
                        return;
                    }

                    const item = data.item;
                    const formattedItem = {
                        id: item.publishedFileId.toString(),
                        name: item.title,
                        author: item.steamIDOwner.toString(),
                        subscribedDate: new Date(item.timeAdded * 1000).toLocaleDateString(),
                        lastUpdated: new Date(item.timeUpdated * 1000).toLocaleDateString(),
                        size: formatFileSize(item.fileSize),
                        previewUrl: item.previewImageUrl || '../static/icons/Steam_icon_logo.png',
                        description: item.description || 'æš‚æ— æè¿°',
                        downloadCount: 'N/A',
                        rating: 'N/A',
                        tags: ['æ¨¡ç»„'], // é»˜è®¤æ ‡ç­¾ï¼Œå®é™…åº”ç”¨ä¸­åº”è¯¥ä»APIè·å–
                        state: item.state || {} // æ·»åŠ stateå±æ€§ï¼Œç¡®ä¿åç»­ä»£ç å¯ä»¥æ­£å¸¸è®¿é—®
                    };

                    // ç¡®å®šçŠ¶æ€ç±»å’Œæ–‡æœ¬
                    let statusClass = 'status-subscribed';
                    let statusText = getStatusText(formattedItem.state || {});

                    if (formattedItem.state && formattedItem.state.downloading) {
                        statusClass = 'status-downloading';
                    } else if (formattedItem.state && formattedItem.state.needsUpdate) {
                        statusClass = 'status-needs-update';
                    } else if (formattedItem.state && formattedItem.state.installed) {
                        statusClass = 'status-installed';
                    }

                    // è·å–ä½œè€…å¤´åƒï¼ˆä½¿ç”¨é¦–å­—æ¯ä½œä¸ºå ä½ç¬¦ï¼‰
                    const authorInitial = formattedItem.author.substring(0, 2).toUpperCase();

                    // æ›´æ–°æ¨¡æ€æ¡†å†…å®¹
                    document.getElementById('modalTitle').textContent = formattedItem.name;

                    const detailContent = document.getElementById('itemDetailContent');
                    detailContent.innerHTML = `
                <img src="${formattedItem.installedFolder ? `/api/proxy-image?image_path=${encodeURIComponent(formattedItem.installedFolder + '/preview.png')}` : `/api/proxy-image?image_path=${encodeURIComponent(formattedItem.previewUrl)}`}" alt="${formattedItem.name}" class="item-preview-large">
                
                <div class="item-info-grid">
                    <p class="item-info-item">
                        <span class="item-info-label">${window.t ? window.t('steam.author') : 'ä½œè€…'}:</span>
                        <div class="author-info">
                            <div class="author-avatar">${authorInitial}</div>
                            <span>${formattedItem.author}</span>
                        </div>
                    </p>
                    <p class="item-info-item"><span class="item-info-label">${window.t ? window.t('steam.subscribed_date') : 'è®¢é˜…æ—¥æœŸ'}:</span> ${formattedItem.subscribedDate}</p>
                    <p class="item-info-item"><span class="item-info-label">${window.t ? window.t('steam.last_updated') : 'æœ€åæ›´æ–°'}:</span> ${formattedItem.lastUpdated}</p>
                    <p class="item-info-item"><span class="item-info-label">${window.t ? window.t('steam.size') : 'å¤§å°'}:</span> ${formattedItem.size}</p>
                    <p class="item-info-item">
                        <span class="item-info-label">${window.t ? window.t('steam.status_label') : 'çŠ¶æ€'}:</span>
                        <span class="status-badge ${statusClass}">${statusText}</span>
                    </p>
                    <p class="item-info-item"><span class="item-info-label">${window.t ? window.t('steam.download_count') : 'ä¸‹è½½æ¬¡æ•°'}:</span> ${formattedItem.downloadCount}</p>
                    ${formattedItem.state && formattedItem.state.downloading && item.downloadProgress ?
                            `<p class="item-info-item" style="grid-column: span 2;">
                            <div class="download-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${item.downloadProgress.percentage}%">
                                        ${item.downloadProgress.percentage.toFixed(1)}%
                                    </div>
                                </div>
                            </div>
                        </p>` : ''
                        }
                </div>
                
                <div>
                    <h4>${window.t ? window.t('steam.tags') : 'æ ‡ç­¾'}</h4>
                    <div class="tags-container">
                        ${formattedItem.tags.map(tag => `
                            <div class="tag">${tag}</div>
                        `).join('')}
                    </div>
                </div>
                
                <div>
                    <h4>${window.t ? window.t('steam.description') : 'æè¿°'}</h4>
                    <p class="item-description">${formattedItem.description}</p>
                </div>
            `;

                    // æ‰“å¼€æ¨¡æ€æ¡†
                    openModal();
                })
                .catch(error => {
                    console.error('è·å–ç‰©å“è¯¦æƒ…å¤±è´¥:', error);
                    showMessage(window.t ? window.t('steam.cannotLoadItemDetails') : 'æ— æ³•åŠ è½½ç‰©å“è¯¦æƒ…', 'error');
                });
        }

        // å–æ¶ˆè®¢é˜…åŠŸèƒ½
        function unsubscribeItem(itemId, itemName) {
            if (confirm(window.t ? window.t('steam.unsubscribeConfirm', { name: itemName }) : `ç¡®å®šè¦å–æ¶ˆè®¢é˜… "${itemName}" å—ï¼Ÿ`)) {
                // æŸ¥æ‰¾å½“å‰å¡ç‰‡å¹¶æ·»åŠ ç§»é™¤åŠ¨ç”»æ•ˆæœ
                const cards = document.querySelectorAll('.workshop-card');
                for (let card of cards) {
                    const cardTitle = card.querySelector('.card-title').textContent;
                    if (cardTitle === itemName) {
                        // æ·»åŠ æ·¡å‡ºæ•ˆæœ
                        card.style.opacity = '0.6';
                        card.style.transform = 'scale(0.95)';
                        break;
                    }
                }

                // è°ƒç”¨åç«¯APIæ‰§è¡Œå–æ¶ˆè®¢é˜…æ“ä½œ
                showMessage(window.t ? window.t('steam.cancellingSubscription', { name: itemName }) : `Cancelling subscription to "${itemName}"...`, 'success');

                fetch('/api/steam/workshop/unsubscribe', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ item_id: itemId })
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.success) {
                            // æ˜¾ç¤ºå¼‚æ­¥æ“ä½œçŠ¶æ€
                            let statusMessage = window.t ? window.t('steam.unsubscribeAccepted', { name: itemName }) : `å·²æ¥å—å–æ¶ˆè®¢é˜…: ${itemName}`;
                            if (data.status === 'accepted') {
                                statusMessage = window.t ? window.t('steam.unsubscribeProcessing', { name: itemName }) : `æ­£åœ¨å¤„ç†å–æ¶ˆè®¢é˜…: ${itemName}`;
                            }
                            showMessage(statusMessage, 'success');

                            // ç«‹å³é‡æ–°åŠ è½½è®¢é˜…åˆ—è¡¨
                            loadSubscriptions();

                            // æ·»åŠ çŸ­æš‚å»¶è¿Ÿåå†æ¬¡åˆ·æ–°ï¼Œç¡®ä¿è·å–æœ€æ–°çŠ¶æ€
                            setTimeout(() => {
                                loadSubscriptions();
                                showMessage(window.t ? window.t('steam.subscriptionsUpdated') : 'è®¢é˜…æ›´æ–°å®Œæˆ', 'success');
                            }, 1000);

                        } else {
                            const errorMsg = data.error || (window.t ? window.t('common.unknownError') : 'æœªçŸ¥é”™è¯¯');
                            showMessage(window.t ? window.t('steam.unsubscribeFailed') : `å–æ¶ˆè®¢é˜…å¤±è´¥: ${errorMsg}`, 'error');
                            // å¦‚æœæœ‰æ¶ˆæ¯æç¤ºï¼Œæ˜¾ç¤ºç»™ç”¨æˆ·
                            if (data.message) {
                                showMessage(data.message, 'warning');
                            }
                        }
                    })
                    .catch(error => {
                        console.error('å–æ¶ˆè®¢é˜…å¤±è´¥:', error);
                        showMessage(window.t ? window.t('steam.unsubscribeError') : 'å–æ¶ˆè®¢é˜…å¤±è´¥', 'error');
                    });
            }
        }

        // åˆå§‹åŒ–é¡µé¢ - éœ€è¦ç­‰å¾… i18n åŠ è½½å®Œæˆ
        function initPage() {
            // åˆå§‹åŒ–æ—¶æ·»åŠ ä¸€äº›ç¤ºä¾‹æ ‡ç­¾
            addTag(window.t ? window.t('steam.defaultTagMod') : 'Mod');
            addTag(window.t ? window.t('steam.defaultTagCharacter') : 'Character');

            // åˆå§‹åŒ–i18næ–‡æœ¬
            if (document.getElementById('loading-text')) {
                document.getElementById('loading-text').textContent = window.t ? window.t('steam.loadingSubscriptions') : 'æ­£åœ¨åŠ è½½æ‚¨çš„è®¢é˜…ç‰©å“...';
            }
            if (document.getElementById('reload-button')) {
                document.getElementById('reload-button').textContent = window.t ? window.t('steam.reload') : 'é‡æ–°åŠ è½½';
            }
            if (document.getElementById('search-subscription')) {
                document.getElementById('search-subscription').placeholder = window.t ? window.t('steam.searchPlaceholder') : 'æœç´¢è®¢é˜…å†…å®¹...';
            }

            // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½è®¢é˜…å†…å®¹
            loadSubscriptions();

            // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ‰«ææœ¬åœ°ç‰©å“
            scanLocalItems();
        }

        // æ£€æŸ¥ i18n æ˜¯å¦å·²åˆå§‹åŒ–ï¼Œå¦‚æœæ²¡æœ‰åˆ™ç­‰å¾…
        function waitForI18nAndInit() {
            let initialized = false;

            function doInit() {
                if (initialized) return;
                initialized = true;
                initPage();
            }

            // å¦‚æœ window.t å·²ç»å­˜åœ¨ä¸” i18n å·²åˆå§‹åŒ–ï¼Œç›´æ¥æ‰§è¡Œ
            if (typeof window.t === 'function' && window.i18n && window.i18n.isInitialized) {
                doInit();
            } else {
                // ç›‘å¬ localechange äº‹ä»¶ï¼ˆi18n åˆå§‹åŒ–å®Œæˆåè§¦å‘ï¼‰
                window.addEventListener('localechange', doInit, { once: true });

                // å®‰å…¨ç½‘ï¼š5ç§’åå¼ºåˆ¶åˆå§‹åŒ–ï¼ˆå³ä½¿ i18n æœªå®Œæˆï¼‰
                setTimeout(() => {
                    if (!initialized && typeof window.t !== 'function') {
                        console.warn('[Workshop] i18n æœªå°±ç»ªï¼Œä½¿ç”¨é»˜è®¤æ–‡æœ¬åˆå§‹åŒ–');
                    }
                    doInit();
                }, 5000);
            }
        }

        window.onload = function () {
            waitForI18nAndInit();
        };
    </script>
</body>

</html>